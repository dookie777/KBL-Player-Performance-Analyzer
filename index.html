<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <meta charset="UTF-8">
  <title>KBL Player Stats Analyzer</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">

  <style>
body { 
background-color: #000000;
  background-image: 
    linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
  background-size: 30px 30px;
  background-position: center;
  color: #FFF;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

.tab-content.active {
  display: flex !important;
  flex-direction: column;
  flex: 1;
  height: 100%;
}

.container {
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
  box-sizing: border-box;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

h2 {
  text-align: center;
  color: #FFA500;
}

.tabs {
  text-align: center;
  margin-bottom: 20px;
}

.tabs button {
  background: #282828;
  color: #FFF;
  padding: 10px 20px;
  border: none;
  cursor: pointer;
  margin: 0 5px;
  font-weight: bold;
  width: 160px;
}

.tabs button.active {
  background: #E0E0E0;
  color: #000;
}

.tab-content {
  display: none !important;
  flex-direction: column;
  flex: 1;
}

.tab-content.active {
  display: flex !important;
}

.input-box {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px; /* âœ… ëª¨ë“  ê°„ê²© ê· ì¼í™” */
  margin-top: 0 !important;
  margin-bottom: 20px;
}

.input-box input[type="text"],
.input-box button {
  height: 42px;
  padding: 0 15px;
  font-size: 0.9rem;
  border-radius: 5px;
  border: none;
  box-sizing: border-box;
  margin: 0; /* âœ… margin ì œê±° */
}


.input-box input[type="text"] {
  width: 250px;
  font-size: 1rem;
}

.input-box button {
  background-color: #88c2dd;
  color: #121212;
  cursor: pointer;
  font-weight: bold;
}

.input-box input[type="checkbox"] {
  margin: 0 1px;
}

.input-box label {
  color: #FFF;
  font-size: 0.9rem;
  cursor: pointer;
  user-select: none;
}

.scroll-container::-webkit-scrollbar,
.stats-container::-webkit-scrollbar,
.compare-result::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.scroll-container::-webkit-scrollbar-track,
.stats-container::-webkit-scrollbar-track,
.compare-result::-webkit-scrollbar-track {
  background: #121212;
  border-radius: 5px;
}

.scroll-container::-webkit-scrollbar-thumb,
.stats-container::-webkit-scrollbar-thumb,
.compare-result::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 5px;
  border: 2px solid #121212;
}

table {
  border-collapse: collapse;
  white-space: nowrap;
  width: max-content;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #333;
  font-size: 0.85rem;
  text-align: center;
  background: #181818;
  font-weight: bold;
}

thead th {
  background: #282828;
  position: sticky;
  top: 0;
  cursor: pointer;
  z-index: 500;
}

#statsTable {
  min-width: max-content !important;
  width: max-content !important;
}    
    
#statsTable td:first-child {
  z-index: 3;
  position: sticky;
  left: 0;
  background-color: #282828;
  max-height: calc(100vh - 100px); /* í˜„ì¬ ìˆìŒ */
  contain: layout; /* âœ… ì´ ì¤„ì„ ì¶”ê°€í•˜ë©´ stickyê°€ í‘¸í„°ë¥¼ ë„˜ì§€ ëª»í•¨ */
}

.highlight { 
  color: #FFFF55 !important; 
  font-weight: bold; 
}

.player-name {
  font-size: 2rem;
  font-weight: bold;
  margin: 15px 0 5px;
  text-align: center;
}

.team-name {
  font-size: 1rem;
  text-align: center;
  margin-bottom: 15px;
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 20px;
  padding-bottom: 60px;
}

.card {
  background-color: rgba(255,255,255,0.05);
  padding: 0px 10px 10px 10px; /* ìƒë‹¨ë§Œ 0 */
  border-radius: 0px;
  text-align: center;
  min-height: 350px;
}

.card.primary:nth-child(2) { min-height: 420px; }
.card.primary h3 { color: #FFA500; }
.card.secondary h3 { color: #88c2dd; }

.card h3 {
  padding: 0px 10px 10px 10px; /* topì„ 5pxë¡œ ì¤„ì„ */
  font-size: 1.1rem;
}

.card table {
  width: 100%;
}

.card th, .card td {
  padding: 8px 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}

.card.team-stats {
  min-height: unset !important;
  height: auto !important;
}

.card.team-stats h3 {
  color: #88c2dd !important;
}

#tab-compare .compare-result {
  max-width: none !important;
  height: calc(100vh - 260px);
  padding: 5px;
  margin: 0 auto;
}

#tab-compare .compare-result table {
  table-layout: auto !important;
  transform: none !important;
}

#tab-compare .compare-result th,
#tab-compare .compare-result td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 10px 15px !important;
  font-size: 0.85rem !important;
  border-left: 1px solid #444 !important;  /* âœ… ì„¸ë¡œì„  ì¶”ê°€ */
  border-right: 1px solid #444 !important; /* âœ… ì„¸ë¡œì„  ì¶”ê°€ */
}

#tab-compare .compare-result th:first-child {
  border-left: 0px solid #444 !important;
}
/* ì²« ë²ˆì§¸ ì…€ - ì™¼ìª½ ê²½ê³„ì„  */
#tab-compare .compare-result th:first-child,
#tab-compare .compare-result td:first-child {
  border-left: 1px solid #444 !important;
}

/* ë§ˆì§€ë§‰ ì…€ - ì˜¤ë¥¸ìª½ ê²½ê³„ì„  */
#tab-compare .compare-result td:last-child {
  border-right: 1px solid #444 !important;
}

/* ìƒë‹¨ í…Œë‘ë¦¬ ë³´ê°• */
#tab-compare .compare-result thead th {
  border-top: 1px solid #444 !important;
}



#tab-compare .compare-result table {
  border-collapse: separate !important;
  border-spacing: 0 !important;
}

#tab-compare .compare-result th {
  background-color: #282828 !important;
  padding: 15px !important;
}
#tab-compare .compare-result::after {
  content: '';
  display: block;
  height: 0px; /* â† ì´ ìˆ«ìê°€ ê³µë°± ë†’ì´ */
}
    
.highlight-first {
  background-color: #FFD3C4 !important;  /* 1ë“±: ë°ì€ ì‚´êµ¬ë¹› ë¹¨ê°• */
  color: #000 !important;
  font-weight: bold;
}

.highlight-second {
  background-color: #D7F2FF !important;  /* 2ë“±: ë°ì€ í•˜ëŠ˜ìƒ‰ */
  color: #000 !important;
  font-weight: bold;
}

.highlight-third {
  background-color: #F0F0F0 !important;  /* 3ë“±: ë°ì€ íšŒìƒ‰ */
  color: #000 !important;
  font-weight: bold;
}

.footer {
  z-index: 9999 !important;
  text-align: center;
  padding: 10px;
  font-size: 0.8rem;
  color: #888;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #000;
  pointer-events: none;
}


/* âœ… ì„ ìˆ˜ ê°œì¸ ê²€ìƒ‰ í˜ì´ì§€ ê°„ê²© ì¶•ì†Œ (ì¤‘ìš” ìˆ˜ì •) */
#tab-player {
  overflow-y: auto;
  max-height: calc(100vh - 160px); /* í—¤ë” + íƒ­ ë²„íŠ¼ ë“± ì—¬ë°± ì œì™¸ */
  padding-bottom: 50px; /* í‘¸í„°ì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ê³µê°„ í™•ë³´ */
}
    
#tab-player .input-box {
  margin-bottom: 10px !important; /* ê¸°ì¡´ 20px â†’ ì ˆë°˜ìœ¼ë¡œ ìˆ˜ì • */
}

#tab-player .player-name {
  margin-bottom: 3px !important;
}

#tab-player .team-name {
  margin-bottom: 2px !important;
}

#tab-player .stats-container {
  margin-top: -25px !important;
  padding-bottom: 0px !important; /* âœ… í‘¸í„°ì™€ ê²¹ì¹¨ ë°©ì§€ ì—¬ë°± ì¶”ê°€ */
  padding-right: 15px !important; /* âœ… ì˜¤ë¥¸ìª½ ìŠ¤í¬ë¡¤ë°”ì™€ ê°„ê²© í™•ë³´ */
  max-height: calc(100vh - 240px);
  overflow-y: auto;
}
    
#tab-player .stats-container::after {
  content: '';
  display: block;
  height: 0px;
}
#tab-player #filterContainer {
  width: 100%;
  display: flex;
  justify-content: flex-start;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 0 15px 0;
}

#tab-player .filter-box-inline {
  display: flex;
  gap: 10px;
  padding-left: 0;
  margin: 0;
}

#tab-player .filter-box-inline .filter-btn {
  padding: 6px 12px;
  border: 1px solid #FFA500;
  background-color: #333;     /* ì–´ë‘ìš´ íšŒìƒ‰ */
  color: #FFF;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: bold;
}

#tab-player .filter-box-inline .filter-btn.active {
  background-color: #FFA500;
  color: #000;
}



/* âœ… ì„ ìˆ˜ ë¹„êµ í˜ì´ì§€ ì…ë ¥ì°½ í¬ê¸° ë° ì˜ì—­ ìµœì í™” (ì¤‘ìš” ìˆ˜ì •) */
#tab-compare .input-box input[type="text"] {
  font-size: 0.85rem !important; /* âœ… ê¸°ì¡´ë³´ë‹¤ ì‘ê²Œ */
  width: 150px !important; /* ê¸°ì¡´ 200px â†’ 2/3 í¬ê¸° */
}

#tab-compare .input-box {
  justify-content: space-between; /* ë„“ì€ ì˜ì—­ í™œìš© */
  max-width: 900px;
  margin: 0 auto 10px auto !important;
  padding: 0;
}

/* ì…ë ¥ì°½ê³¼ ë²„íŠ¼ ì •ë ¬ ìµœì í™” */
#tab-compare .input-box button {
  flex-grow: 1;
  max-width: 100px;
  margin: 5px;
}

/* ì²´í¬ë°•ìŠ¤ ë° ë¼ë²¨ ìš°ì¸¡ ì •ë ¬ */
#tab-compare .input-box input[type="checkbox"],
#tab-compare .input-box label {
  flex-grow: 1;
  text-align: right;
  margin: 0 5px;
}

/* ë¹„êµ ê²°ê³¼ í…Œì´ë¸” ê°€ë¡œ ì˜ì—­ ìµœì í™” */
#tab-compare .compare-result {
  max-width: 100% !important;
  width: 100% !important;
  height: calc(100vh - 220px) !important;
  overflow: auto !important;
  margin: 0 auto;
  padding: 10px !important;

}

#tab-compare .compare-result table {
  width: max-content !important;
  min-width: 100% !important;
}

/* âœ… ì„ ìˆ˜ ë¹„êµ ê²€ìƒ‰ ë°ì´í„° ì˜ì—­ ë„“ì´ ì •í™•íˆ ì¡°ì • (ì¤‘ìš”!) */
#tab-compare .compare-result {
  max-width: 900px !important;
  width: 100% !important;
  margin: 0 auto;
  padding: 10px !important;
  padding-top: 0px !important;  /* âœ… ì´ ì¤„ì„ ì¶”ê°€í•©ë‹ˆë‹¤ */
  border-top: 1px solid #121212 !important;
  overflow-y: auto !important;
  overflow-x: hidden;
  max-height: 500px !important;  /* â† ì´ ì¤„ì´ ë°”ë¡œ ë¬¸ì œì˜ í•µì‹¬ì…ë‹ˆë‹¤ */
  box-sizing: border-box !important;
  position: relative;
  background-color: #121212 !important;
  scroll-padding-top: 40px;  /* âœ… ì¶”ê°€ëœ í•œ ì¤„ */

}

/* í…Œì´ë¸” ë„ˆë¹„ ì •í™•íˆ ì¡°ì • */
#tab-compare .compare-result table {
  width: 100% !important;
  min-width: 100% !important;          /* âœ… container ê¸°ì¤€ ì œí•œ */
  table-layout: fixed !important;      /* âœ… ê° ì…€ ë„ˆë¹„ ê³ ì • */
  word-break: break-word !important;   /* âœ… ê¸´ í…ìŠ¤íŠ¸ ìë™ ì¤„ë°”ê¿ˆ */
}

/* ìŠ¤í¬ë¡¤ ì‹œ ë°ì´í„°ê°€ í—¤ë” ë’¤ë¡œ ë³´ì´ëŠ” í˜„ìƒ ìˆ˜ì • */
#tab-compare .compare-result th {
  background-color: #282828 !important;
  position: sticky !important;
  top: 0 !important;
  z-index: 1000 !important;
}
#tab-compare .compare-result th span {
  font-size: 0.85rem !important;
  font-weight: 600 !important;
}
/* ì œëª© í—¤ë” ë°°ê²½ìœ¼ë¡œ ë°ì´í„°ê°€ ë³´ì´ì§€ ì•Šê²Œ ì„¤ì • */
#tab-compare .compare-result {
  position: relative;
  background-color: #121212 !important;
}

/* ì°¨ì´ ì—´ ê²°ê³¼ê°’ í°íŠ¸ ì‘ê²Œ ì¡°ì • */
#tab-compare .compare-result td.diff-cell span {
  font-size: 0.9rem !important; /* í°íŠ¸ í¬ê¸° 1.2remìœ¼ë¡œ ì§€ì • */
}

#tab-compare .compare-result {
  background-color: transparent !important;
}

#tab-compare .compare-result table {
  background-color: transparent !important;
}
    
/* ë¹¨ê°„ ì •ì‚¼ê°í˜• ì•„ì´ì½˜ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
.diff-positive::before {
  content: "â–²";
  color: red;
  margin-right: 4px;
  font-size: 0.8rem;
}
/* ìŒìˆ˜(-)ê°’: íŒŒë€ ì—­ì‚¼ê°í˜• ì•„ì´ì½˜ ì¶”ê°€ */
.diff-negative::before {
  content: "â–¼";
  color: #007BFF; /* ì™„ì „í•œ íŒŒë€ìƒ‰ */
  margin-right: 5px;
  font-size: 0.8rem;
}
/* 3í˜ì´ì§€ ì „ìš© (ì„ ìˆ˜ ë¹„êµ ê²€ìƒ‰ íƒ­) */
#tab-compare .category-checkboxes {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 10px 20px;
  max-width: 900px;
  margin: 10px auto 20px auto;
  justify-content: center;
  align-items: center;
}
#tab-compare .category-checkboxes label {
  font-size: 0.85rem;
  white-space: nowrap;
  display: flex;
  align-items: center;
  justify-content: center;
}
#tab-compare .category-checkboxes input[type="checkbox"] {
  margin-right: 7px;
}
/* 4í˜ì´ì§€ ì „ìš© (ê°œì¸ ë¹„êµ ê²€ìƒ‰ íƒ­) */
#tab-player-compare .category-checkboxes {
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 215px;
  overflow-x: auto;
  overflow-y: hidden;
  padding: 20px 30px 40px 30px;
  white-space: nowrap;
  box-sizing: border-box;
  margin-bottom: 10px;
}
#tab-player-compare .category-checkboxes .row {
  display: flex;
  flex-wrap: nowrap;
  gap: 16px;
}
#tab-player-compare .category-checkboxes label {
  font-size: 0.7rem;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
#tab-player-compare .category-checkboxes input[type="checkbox"] {
  width: 12px;
  height: 12px;
}


/* ìƒë‹¨ 6ê°œ í•­ëª© ì •í™•íˆ ê· ë“± ë°°ì¹˜ (í•œ í–‰ì— í•˜ë‚˜ì”© ì •í™•íˆ ë“¤ì–´ê°€ë„ë¡ ì„¤ì •) */
.category-checkboxes label:nth-child(-n+6) {
  grid-column: span 1; /* 6ê°œ í•­ëª© ì •í™•íˆ í•œ ì¹¸ì”© ë‚˜ëˆ” */
}

/* í•˜ë‹¨ 4ê°œ í•­ëª©ì€ ë” ë„“ê²Œ, ì •í™•íˆ ì¤‘ì•™ ì •ë ¬ */
.category-checkboxes label:nth-child(n+7) {
  grid-column: span 1; /* ë„“ê²Œ 2ì¹¸ì”© ì‚¬ìš©í•˜ì—¬ ì—¬ìœ ë¥¼ ë‘  */
}

/* í•˜ë‹¨ 4ê°œ í•­ëª©ì´ ì •í™•íˆ ì¤‘ì•™ ì •ë ¬ë˜ë„ë¡ ì‹œì‘ ìœ„ì¹˜ ì§€ì • */
.category-checkboxes label:nth-child(7) {
  grid-column-start: 2; /* ì •í™•íˆ ì¤‘ì•™ ì‹œì‘ì  ì§€ì • */
}

.category-checkboxes label:nth-child(2) {
  margin-left: -40px; /* ìŠˆíŒ… ì§€í‘œë¥¼ WinShare ì§€í‘œì— ë§ì¶¤ */
}

.category-checkboxes label:nth-child(10) {
  margin-left: -38px; /* Teamë‚´ ë¹„ì¤‘ ì§€í‘œë¥¼ ì–´ì‹œìŠ¤íŠ¸ì— ë§ì¶¤ */
}
.side-logo {
  position: fixed;
  top: 65%; /* í™”ë©´ ì¤‘ì•™ë³´ë‹¤ ì¡°ê¸ˆ ì•„ë˜ (ì œì‹œí•˜ì‹  í°ìƒ‰ ì„  ë†’ì´) */
  transform: translateY(-50%);
  width: 160px; 
  height: 160px;
  background: transparent;
  z-index: 1000;
}

.side-logo.left {
  left: 100px; 
}

.side-logo.right {
  position: fixed;
  top: calc(50% + 180px); /* ì¤‘ì•™ì—ì„œ ì•„ë˜ë¡œ 80px ë‚´ë ¤ê° (ë‚˜ì´ì¸  ë¡œê³  ì¤‘ì‹¬ì  ë§ì¶”ê¸°) */
  right: 100px;
  width: 160px;
  height: 160px;
  background: transparent;
  z-index: 1000;
}

.side-logo img {
  width: 90%;
  height: auto;
  display: block;
  margin: auto;
}
/* âœ… ì œëª© íŠ¸ë Œë”” ìŠ¤íƒ€ì¼ë§ ì¶”ê°€ */
h2 {
  font-family: 'Poppins', sans-serif;
  font-size: 2rem;
  color: #fff;
  text-shadow: 
    0 0 3px #ff8c00, 
    0 0 6px #ff8c00, 
    0 0 12px #ff4500; 
  letter-spacing: 1px;
  animation: glow 2s infinite alternate;
}

@keyframes glow {
  from { 
    text-shadow: 0 0 3px #ff8c00, 0 0 6px #ff4500; 
  }
  to { 
    text-shadow: 0 0 6px #ff8c00, 0 0 12px #ff4500; 
  }
}

.logo-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 20px 0 5px 0;  /* ìƒë‹¨ ì—¬ë°±ì„ 60pxìœ¼ë¡œ ëŠ˜ë¦¼ */
}

.logo-title .logo {
  height: 50px;
}

.logo-title .title {
  font-size: 1.8rem;
  font-weight: bold;
  color: white;
  font-family: 'Poppins', sans-serif;
}  

/* í—¤ë” í–‰ ê³ ì • */
#statsTable thead th {
  position: sticky;
  top: 0;
  background-color: #282828;
  z-index: 10;
}

#statsTable th:first-child,
#statsTable td:first-child {
  position: sticky;
  left: 0;
  background-color: #282828;
  z-index: 9;
}

#statsTable th,
#statsTable td {
  padding: 10px 14px;
  font-size: 0.9rem;
  text-align: center;
  border-bottom: 1px solid #333;
  background-color: #181818;
  white-space: nowrap;
  font-weight: bold;
}

.scroll-container {
  overflow: auto;
  height: calc(100vh - 290px);  /* ê¸°ì¡´ë³´ë‹¤ 40px ì¤„ì„ */
  padding-bottom: 0;            /* spacerRow í•„ìš” ì—†ìŒ */
  position: relative;
  z-index: 1;
}

.scroll-container::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.scroll-container::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 5px;
  border: 2px solid #121212;
}

.scroll-container::-webkit-scrollbar-track {
  background: #121212;
}

#statsTable thead th:first-child {
  position: sticky;
  top: 0;
  left: 0;
  background-color: #282828;
  z-index: 11;
}

/* í‘¸í„° ê²¹ì¹¨ ë°©ì§€ìš© ì—¬ë°± */
#statsTable::after {
  content: '';
  display: block;
  height: 80px;
}

#tab-player .player-name {
  font-size: 1.8rem;
  font-weight: 700;
  margin: 8px 0 3px 0 !important;
  text-align: center;
}

#tab-player .team-name {
  font-size: 1rem;
  margin-bottom: 10px !important;
  text-align: center;
}

   
/* í…Œì´ë¸” ì…€ ì™¸ê³½ì„  ì •ë¦¬ (ëª¨ë“  ì…€ ë™ì¼ ì„  ìƒ‰) */
#tab-compare .compare-result th,
#tab-compare .compare-result td {
  border: 1px solid #444 !important;
}

/* ê°•ì¡° ì…€ë„ border ë™ì¼í•˜ê²Œ */
#tab-compare .compare-result .highlight-first,
#tab-compare .compare-result .highlight-second,
#tab-compare .compare-result .highlight-third,
#tab-compare .compare-result .diff-cell {
  border: 1px solid #444 !important;
}

/* í—¤ë” ê²¹ì¹¨ ë°©ì§€ ë° ì‹œê°ì  ì•ˆì •ì„± */
#tab-compare .compare-result thead th {
  position: sticky !important;
  top: 0 !important;
  z-index: 10 !important;
  background-color: #282828 !important;
  border-bottom: 2px solid #555 !important;
}
@media (max-width: 1200px) {
  /* 1í˜ì´ì§€: ë¡œê³ /íŒŒì¼ ë²„íŠ¼ ìˆ¨ê¹€ */
  .side-logo {
    display: none !important;
  }

  .upload-box {
    display: none !important;
  }

  /* 2í˜ì´ì§€: ì¹´ë“œ 3ì—´ â†’ 2ì—´ */
  #tab-player .stats-container {
    grid-template-columns: repeat(2, 1fr) !important;
  }

  /* 3í˜ì´ì§€: ë¹„êµ í…Œì´ë¸” í­ ìë™ ì¡°ì • */
  #tab-compare .compare-result {
    max-width: 100% !important;
    overflow-x: auto !important;
  }
}

@media (max-width: 950px) {
  /* 2í˜ì´ì§€: ì¹´ë“œ 2ì—´ â†’ 1ì—´ */
  #tab-player .stats-container {
    grid-template-columns: 1fr !important;
    display: grid !important;
  }

  /* 3í˜ì´ì§€: í…Œì´ë¸” ìë™ í­ + í°íŠ¸ ì¤„ì´ê¸° */
  #tab-compare .compare-result table {
    width: 100% !important;
    min-width: unset !important;
    table-layout: auto !important;
    font-size: 0.8rem !important;
  }
}

@media (max-width: 600px) {
  /* 3í˜ì´ì§€: í°íŠ¸ ë” ì‘ê²Œ (ëª¨ë°”ì¼ ê·¹ë‹¨ì  ëŒ€ì‘) */
  #tab-compare .compare-result table {
    font-size: 0.75rem !important;
  }
}

@media (max-width: 1200px) {
  .upload-box {
    display: none !important;
  }
}
.input-box select#seasonSelector {
  width: 90px;
  height: 42px;
  background-color: #181818;
  color: #fff;
  font-weight: bold;
  font-size: 0.85rem;
  border: none;
  border-radius: 5px;
  padding: 0 5px; /* âœ… ì˜¤ë¥¸ìª½ ê³µê°„ ì¤„ì´ê¸° */
  margin: 0;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: none !important;
  text-align: center;
  text-align-last: center;
  display: flex;
  align-items: center;
  justify-content: center; /* âœ… í…ìŠ¤íŠ¸ ì™„ì „ ì •ì¤‘ì•™ */
}
.input-box select#seasonSelector::-ms-expand {
  display: none; /* IEì—ì„œ í™”ì‚´í‘œ ì œê±° */
}

.input-box select#seasonSelectorPlayer {
  width: 90px;
  height: 42px;
  background-color: #181818;
  color: #fff;
  font-weight: bold;
  font-size: 0.85rem;
  border: none;
  border-radius: 5px;
  padding: 0 5px;
  margin: 0;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: none !important;
  text-align: center;
  text-align-last: center;
  display: flex;
  align-items: center;
  justify-content: center;
}
.input-box select#seasonSelectorPlayer::-ms-expand {
  display: none;
}  

.input-box {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 20px;
}

.input-group {
  display: flex;
  gap: 10px;
}

.checkbox-group {
  display: flex;
  align-items: center;
  gap: 4px; /* ì²´í¬ë°•ìŠ¤ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
  margin-left: 10px; /* Compare ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
}
.checkbox-group input[type="checkbox"] {
  margin: 0; /* ê¸°ë³¸ ì—¬ë°± ì œê±° */
}

.checkbox-group label {
  font-size: 0.85rem;
  font-weight: normal;
  color: #FFF;
}
.season-switch {
  background-color: rgba(255, 255, 255, 0.12); /* ê²€ì€ ë°°ê²½ë³´ë‹¤ í™•ì‹¤íˆ ë°ê³  ê¹¨ë—í•œ ëŒ€ë¹„ */
  color: #fff; /* í…ìŠ¤íŠ¸ëŠ” í°ìƒ‰ìœ¼ë¡œ ìœ ì§€ */
  font-weight: bold;
  font-size: 0.70rem;
  border: none; /* í…Œë‘ë¦¬ ì œê±° */
  border-radius: 4px;
  padding: 4px 8px;
  margin-left: 6px;
  vertical-align: middle;
  appearance: none;
  cursor: pointer;
  height: 28px;
  line-height: 1.1;
  transition: background-color 0.2s ease;
}

.season-switch:hover {
  background-color: rgba(255, 255, 255, 0.18); /* ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì‹œ ì•½ê°„ ë” ë°ì•„ì§ */
}
.filter-box-inline {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  padding-left: 5px;
}

.filter-toggle {
  padding: 0 12px;
  height: 28px; /* ì£¼ì¸ë‹˜ì´ ìš”ì²­í•˜ì‹  ë‚®ì€ ë†’ì´ë¡œ ì¡°ì • */
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #222;
  color: #fff;
  border: 1px solid #888;
  border-radius: 5px;
  font-size: 0.7rem;
  cursor: pointer;
}

.filter-toggle.selected {
  background-color: #FFA500;
  color: #000;
  font-weight: bold;
  border-color: #FFA500;
}


.filter-box-inline .filter-btn {
  padding: 6px 12px;
  border: 1px solid #FFA500;
  background-color: #333;     /* ì–´ë‘ìš´ íšŒìƒ‰ */
  color: #FFF;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.filter-box-inline .filter-btn.active {
  background-color: #FFA500;
  color: #000;
}


#tab-compare .filter-box-inline {
  display: flex;
  gap: 10px;
  justify-content: flex-start;
  margin: 12px 0 20px 0;
  padding-left: 0px;
  padding-bottom: 10px;
  width: fit-content;
  box-sizing: border-box;
  transform: translateX(133px); /* âœ… Player ì—´ê³¼ ì •í™•íˆ ê°™ì€ ìœ„ì¹˜ë¡œ ì´ë™ */
}
    
#tab-compare .filter-box-inline .filter-btn {
  padding: 0 12px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #222;
  color: #fff;
  border: 1px solid #888;
  border-radius: 5px;
  font-size: 0.7rem;
  font-weight: bold;
  cursor: pointer;
}

#tab-compare .filter-box-inline .filter-btn.active {
  background-color: #FFA500;
  color: #000;
  border-color: #FFA500;
}

#tab-player #playerFilterBox,
#tab-player #statsContainer {
  display: none;
}
#tab-player .player-title {
  font-size: 1.8rem;
  font-weight: bold;
  text-align: center;
  margin: 15px 0 10px 0; /* ì•„ë˜ ì—¬ë°± ì¡°ì ˆ */
}

#tab-player .filter-box-inline {
  position: relative !important;
  margin-bottom: 25px !important;
  justify-content: center;
  padding-left: 0 !important;
}

.filter-box-inline .filter-btn {
  padding: 6px 12px;
  border: 1px solid #888;
  background-color: #222;
  color: #FFF;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
  font-weight: bold;
}

.filter-box-inline .filter-btn.active {
  background-color: #FFA500;
  color: #000;
  border-color: #FFA500;
}
#tab-player-compare .input-box {
  display: flex !important;
}    

#tab-player-compare .filter-box-inline {
  justify-content: center;
  margin-bottom: 0px;
}
#tab-player-compare .stats-container {
  display: flex;
  justify-content: center;          /* âœ… ì¹´ë“œë“¤ì„ í™”ë©´ ì •ì¤‘ì•™ì— ë§ì¶¤ */
  flex-wrap: wrap;
  gap: 20px;
  max-width: 100%;                 /* âœ… ê³ ì •í­ ì œê±° */
  margin: 0 auto;
}
.stat-card {
  background-color: rgba(255,255,255,0.05);
  padding: 15px;
  border-radius: 8px;
  min-height: 380px;
}
.stat-card {
  width: 320px;
  padding-top: 0px; /* ì „ì²´ ì¹´ë“œ ì•ˆìª½ ìƒë‹¨ íŒ¨ë”©ì„ ì¤„ì—¬ ê·¸ë˜í”„ë¥¼ ìœ„ë¡œ ì´ë™ */
  flex: 0 0 auto;
}
.stat-card h3 {
  font-size: 1.2rem;
  color: #FFA500;
  margin-bottom: 0px;
}
canvas {
  width: 100% !important;
  margin-top: -5px; /* ì—¬ê¸°ê°€ ì—†ë‹¤ë©´ ìƒˆë¡œ ì¶”ê°€ ê°€ëŠ¥ */
  max-height: 340px;  /* âœ… ê¸°ì¡´ 240px â†’ 360px (1.5ë°°) */
}

#comparePlayerFilterBox {
  justify-content: center;
  margin-bottom: 0px;
  margin-top: 0px;  /* ì„ íƒì ìœ¼ë¡œ ì¡°ì • */
}    
#compareStatCheckboxes {
  display: flex;
  flex-direction: column;
  gap: 6px;                       /* âœ… ì¤„ ê°„ê²© ì¤„ì„ */
  max-height: 215px;             /* âœ… 8ì¤„ ê¸°ì¤€ ë…¸ì¶œ ë†’ì´ë¡œ ì œí•œ */
  overflow-x: auto;              /* âœ… ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
  overflow-y: hidden;
  padding: 20px 30px 40px 30px; /* ìœ„ ì˜¤ë¥¸ ì•„ë˜ ì™¼ */
  white-space: nowrap;           /* âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ */
  box-sizing: border-box;
}

#compareStatCheckboxes {
  margin-bottom: 10px; /* ì´ ê°’ì„ ëŠ˜ë¦¬ë©´ ì•„ë˜ ê²°ê³¼ ì¹´ë“œì™€ì˜ ê°„ê²©ì´ ìƒê¹ë‹ˆë‹¤ */
}    

#compareStatCheckboxes .row {
  display: flex;
  flex-wrap: nowrap;
  gap: 14px;                      /* âœ… ê°€ë¡œ ê°„ê²© ê· ì¼í™” */
}
    
#compareStatCheckboxes .row label {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  width: 140px;                /* âœ… ê³ ì • ë„ˆë¹„ (min-width â†’ width) */
  white-space: nowrap;         /* âœ… ì¤„ë°”ê¿ˆ ê¸ˆì§€ */
  overflow: hidden;            /* âœ… ë„˜ì¹  ê²½ìš° ìˆ¨ê¹€ */
  text-overflow: ellipsis;     /* âœ… ë„˜ì¹  ê²½ìš° ... í‘œì‹œ (ì„ íƒì‚¬í•­) */
  font-size: 0.7rem;
}
    
#compareStatCheckboxes label {
  font-size: 0.7rem;          /* âœ… ì§€í‘œ í…ìŠ¤íŠ¸ í¬ê¸° ì¶•ì†Œ */
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 4px;
}

#compareStatCheckboxes input[type="checkbox"] {
  width: 11px;                 /* âœ… ì²´í¬ë°•ìŠ¤ í¬ê¸° ì¶•ì†Œ */
  height: 11px;
}

#tab-player-compare {
  display: flex;
  flex-direction: column;
  height: auto;             /* ğŸ” ì´ ì¤„ ìˆ˜ì •: ê¸°ì¡´ calc(100vh - 180px) â†’ auto */
  overflow: visible;        /* ğŸ” ì´ ì¤„ ìˆ˜ì •: ê¸°ì¡´ hidden â†’ visible */
}
.scroll-area {
  max-height: calc(100vh - 280px);
  overflow-y: auto;
  padding-right: 10px;
  box-sizing: border-box;
  scroll-behavior: smooth;
}
/* âœ… ìŠ¤í¬ë¡¤ë°” ë””ìì¸ í†µì¼ */
.scroll-area::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.scroll-area::-webkit-scrollbar-track {
  background: #121212;
  border-radius: 5px;
}

.scroll-area::-webkit-scrollbar-thumb {
  background: #555;
  border-radius: 5px;
  border: 2px solid #121212;
}
#compareStatResults {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  align-items: flex-start;
  padding: 20px 20px 80px 20px;
  box-sizing: border-box;
  margin-top: 0 !important;
  padding-top: 0 !important;
  height: auto !important;           /* âœ… í•µì‹¬: ê³ ì • ë†’ì´ ì œê±° */
  overflow: visible !important;      /* âœ… ìŠ¤í¬ë¡¤ ì œê±° */
}
.scroll-area {
  max-height: calc(100vh - 430px);
  overflow-y: auto;
  padding-right: 10px;
  box-sizing: border-box;
  scroll-behavior: smooth;
}
#tab-player-compare .input-box input[type="text"] {
  font-size: 1.0rem !important; /* âœ… ê¸°ì¡´ë³´ë‹¤ ì•½ê°„ ì‘ê²Œ */
  width: 300px !important;        /* í•„ìš” ì‹œ ë„ˆë¹„ë„ í•¨ê»˜ ì¡°ì ˆ */
}
    
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script> <!-- âœ… ì´ ì¤„ ì¶”ê°€ -->
</head>

<body>
  <div class="side-logo left">
<img src="https://github.com/dookie777/KBL-Player-Performance-Analyzer/raw/main/Seoul_SK_Knights_logo.svg.png" alt="Seoul SK Knights Logo">
</div>

<div class="side-logo right">
<img src="https://github.com/dookie777/KBL-Player-Performance-Analyzer/raw/main/SK%ED%85%94%EB%A0%88%EC%BD%A4_%EB%A1%9C%EA%B3%A0.svg.png" alt="SK Telecom Logo">
</div>
<div class="logo-title">
  <img src="https://github.com/dookie777/KBL-Player-Performance-Analyzer/blob/main/Logo_white.png?raw=true" alt="The Eroom Sports Logo" class="logo">
  <span class="title">KBL Player Stats Analyzer</span>
</div>
  
  <div class="container">
  <div class="tabs">
    <button class="tab-button active" data-tab="tab-all">ì„ ìˆ˜ ì „ì²´ ê²€ìƒ‰</button>
    <button class="tab-button" data-tab="tab-player">ì„ ìˆ˜ ê°œì¸ ê²€ìƒ‰</button>
    <button class="tab-button" data-tab="tab-compare">ì„ ìˆ˜ ë¹„êµ ê²€ìƒ‰</button>
    <button class="tab-button" data-tab="tab-player-compare">ê°œì¸ ë¹„êµ ê²€ìƒ‰</button>
  </div>

<div id="tab-all" class="tab-content active">
  <div class="input-box">
  <select id="seasonSelector" onchange="loadPlayersData()">
  <option value="20-21">20-21 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
  <option value="21-22">21-22 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
  <option value="22-23">22-23 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
  <option value="23-24">23-24 ì‹œì¦Œ</option>
  <option value="24-25" selected>24-25 ì‹œì¦Œ</option> <!-- ì´ ì¤„ë§Œ ìˆ˜ì • -->
  </select>
  <input type="text" id="searchPlayerAll" placeholder="Search player..." list="playerSuggestionsAll">
  <datalist id="playerSuggestionsAll"></datalist>    
    <button onclick="searchPlayer()">Search</button>

  </div>

<div class="upload-box" style="position:fixed; top:10px; right:10px; display:flex; align-items:center; gap:5px;">
  <input type="file" id="fileUploader" accept=".xlsx, .xls" style="font-size:0.75rem; color:#FFF;">
  <button onclick="loadLocalFile()" style="background:#555; color:#FFF; padding:4px 8px; border-radius:4px; font-size:0.75rem; cursor:pointer; border:none;">ì—…ë¡œë“œ</button>
</div>

<div class="filter-box-inline" style="margin: 2px 0 8px 0; padding-left: 5px;">
<div class="filter-toggle selected" data-type="êµ­ë‚´">êµ­ë‚´ ì„ ìˆ˜</div>
<div class="filter-toggle selected" data-type="ì™¸êµ­ì¸">ì™¸êµ­ì¸ ì„ ìˆ˜</div>
<div class="filter-toggle selected" data-type="ì•„ì‹œì•„ì¿¼í„°">ì•„ì‹œì•„ì¿¼í„°</div>
  <div style="display: flex; align-items: center; gap: 6px; margin-left: 10px;">
    <input type="checkbox" id="minGamesCheckbox">
    <label for="minGamesCheckbox" style="font-size: 0.75rem; color: white;">ê·œì • ê²½ê¸° ì´ìƒ(14G)</label>
  </div>
</div>
  
<div class="scroll-container">
<table id="statsTable" style="border-collapse: collapse;">
     <thead>
  <tr>
    <th>Player</th>
    <th>Team</th>
    <th>ì¶œì „ ê²½ê¸° ìˆ˜</th>
    <th>ì¶œì „ ì‹œê°„(ì´ˆ)</th>
    <th>ë“ì </th>
    <th>í‰ê·  ë“ì </th>
    <th>FGA</th>
    <th>FG</th>
    <th>í‰ê·  FG ì‹œë„</th>
    <th>í‰ê·  FG ì„±ê³µ</th>
    <th>FG%</th>
    <th>2PA</th>
    <th>2P</th>
    <th>í‰ê·  2p ì‹œë„</th>
    <th>í‰ê·  2p ì„±ê³µ</th>
    <th>2P%</th>
    <th>3PA</th>
    <th>3P</th>
    <th>í‰ê·  3p ì‹œë„</th>
    <th>í‰ê·  3p ì„±ê³µ</th>
    <th>3P%</th>
    <th>FTA</th>
    <th>FT</th>
    <th>í‰ê·  FT ì‹œë„</th>
    <th>í‰ê·  FT ì„±ê³µ</th>
    <th>FT%</th>
    <th>ë¦¬ë°”ìš´ë“œ</th>
    <th>í‰ê·  ë¦¬ë°”ìš´ë“œ</th>
    <th>ê³µê²© ë¦¬ë°”ìš´ë“œ</th>
    <th>í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ</th>
    <th>ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ</th>
    <th>í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ</th>
    <th>ì–´ì‹œìŠ¤íŠ¸</th>
    <th>í‰ê·  ì–´ì‹œìŠ¤íŠ¸</th>
    <th>ìŠ¤í‹¸</th>
    <th>í‰ê·  ìŠ¤í‹¸</th>
    <th>ë¸”ë¡</th>
    <th>í‰ê·  ë¸”ë¡</th>
    <th>í„´ì˜¤ë²„</th>
    <th>í‰ê·  í„´ì˜¤ë²„</th>
    <th>íŒŒìš¸</th>
    <th>í‰ê·  íŒŒìš¸</th>
    <th>WS</th>
    <th>WS/40</th>
    <th>Offensive_WS</th>
    <th>Defensive_WS</th>
    <th>PER</th>
    <th>EFF</th>
    <th>EFF/40</th>
    <th>Offensive_rating</th>
    <th>Defensive_rating</th>
    <th>USG%</th>
    <th>TS%</th>
    <th>eFG%</th>
    <th>3PAr</th>
    <th>FTr</th>
    <th>ORB%</th>
    <th>DRB%</th>
    <th>TRB%</th>
    <th>AST%</th>
    <th>STL%</th>
    <th>BS%</th>
    <th>TOV%</th>
  </tr>
</thead>

      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>


<div id="tab-player" class="tab-content">
  <div class="input-box">
      <select id="seasonSelectorPlayer">
      <option value="20-21">20-21 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
      <option value="21-22">21-22 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
      <option value="22-23">22-23 ì‹œì¦Œ</option> <!-- âœ… ì¶”ê°€ -->
      <option value="23-24">23-24 ì‹œì¦Œ</option>
      <option value="24-25" selected>24-25 ì‹œì¦Œ</option> <!-- ì´ ì¤„ë„ ìˆ˜ì • -->
    </select>
    <input type="text" id="searchPlayer" placeholder="Search player..." list="playerSuggestionsPlayer">
    <datalist id="playerSuggestionsPlayer"></datalist>
    <button id="searchPlayerButton">Search</button>

  </div>

  <!-- ì„ ìˆ˜ëª…/íŒ€ëª… -->
    <div class="player-title" id="playerTitle"></div>
  <!-- âœ… í•„í„° ë²„íŠ¼: ì¹´ë“œ ìƒë‹¨ ì¢Œì¸¡ ì •ë ¬ -->
    <div id="filterContainer">
      <div class="filter-box-inline" id="playerFilterBox" style="display: none;">
        <button class="filter-btn active" data-type="êµ­ë‚´">êµ­ë‚´ ì„ ìˆ˜</button>
        <button class="filter-btn active" data-type="ì™¸êµ­ì¸">ì™¸êµ­ì¸ ì„ ìˆ˜</button>
        <button class="filter-btn active" data-type="ì•„ì‹œì•„ì¿¼í„°">ì•„ì‹œì•„ì¿¼í„°</button>
          <div style="display: flex; align-items: center; gap: 6px; margin-left: 10px;">
          <input type="checkbox" id="minGames">
          <label for="minGames" style="font-size: 0.75rem; color: white;">ê·œì • ê²½ê¸° ì´ìƒ(14G)</label>
        </div>
      </div>
    </div>

  <!-- ê²°ê³¼ ì¹´ë“œ -->
  <div class="stats-container" id="statsContainer"></div>
  <div style="height: 80px;"></div>
</div>


<!-- âœ… 3í˜ì´ì§€ ë³µêµ¬ ì‹œì‘ -->
<div id="tab-compare" class="tab-content">
<div class="input-box">
  <!-- Player 1 -->
<!-- Player 1 -->
<input type="text" id="comparePlayer1" placeholder="Player 1" list="playerSuggestionsCompare1">
<datalist id="playerSuggestionsCompare1"></datalist>

<!-- Player 2 -->
<input type="text" id="comparePlayer2" placeholder="Player 2" list="playerSuggestionsCompare2">
<datalist id="playerSuggestionsCompare2"></datalist>

<!-- Player 3 -->
<input type="text" id="comparePlayer3" placeholder="Player 3(ì„ íƒ)" list="playerSuggestionsCompare3">
<datalist id="playerSuggestionsCompare3"></datalist>


  <button onclick="comparePlayers()">Compare</button>
</div>

  <div id="categoryCheckboxes" class="category-checkboxes">
    <label><input type="checkbox" value="ê¸°ë³¸ ì •ë³´" checked> ê¸°ë³¸ ì •ë³´</label>
    <label><input type="checkbox" value="ìŠˆíŒ… ì§€í‘œ" checked> ìŠˆíŒ… ì§€í‘œ</label>
    <label><input type="checkbox" value="ìŠˆíŒ… ì„±ê³µë¥ " checked> ìŠˆíŒ… ì„±ê³µë¥ </label>
    <label><input type="checkbox" value="ë¦¬ë°”ìš´ë“œ ì§€í‘œ" checked> ë¦¬ë°”ìš´ë“œ ì§€í‘œ</label>
    <label><input type="checkbox" value="ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ" checked> ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ</label>
    <label><input type="checkbox" value="ê¸°íƒ€ ì§€í‘œ" checked> ê¸°íƒ€ ì§€í‘œ</label>
    <label><input type="checkbox" value="WinShare ì§€í‘œ" checked> WinShare ì§€í‘œ</label>
    <label><input type="checkbox" value="íš¨ìœ¨ì„± ì§€í‘œ" checked> íš¨ìœ¨ì„± ì§€í‘œ</label>
    <label><input type="checkbox" value="2ì°¨ ìŠˆíŒ… ì§€í‘œ" checked> 2ì°¨ ìŠˆíŒ… ì§€í‘œ</label>
    <label><input type="checkbox" value="Teamë‚´ ë¹„ì¤‘ ì§€í‘œ" checked> Teamë‚´ ë¹„ì¤‘ ì§€í‘œ</label>
  </div>
<div class="filter-box-inline" id="compareFilterBox"
     style="display: flex; gap: 10px; justify-content: flex-start; margin: 10px 0 0 0; padding-left: 10px;">
  <button class="filter-btn active" data-type="êµ­ë‚´">êµ­ë‚´ ì„ ìˆ˜</button>
  <button class="filter-btn active" data-type="ì™¸êµ­ì¸">ì™¸êµ­ì¸ ì„ ìˆ˜</button>
  <button class="filter-btn active" data-type="ì•„ì‹œì•„ì¿¼í„°">ì•„ì‹œì•„ì¿¼í„°</button>
    <div style="display:flex; align-items:center; gap:6px; margin-left:10px;">
    <input type="checkbox" id="compareMinGames">
    <label for="compareMinGames" style="font-size:0.75rem; color:white;">ê·œì • ê²½ê¸° ì´ìƒ(14G)</label>
  </div>
</div>
  <div class="compare-result" id="compareResult"></div>
</div>

<!-- âœ… ê°œì¸ ë¹„êµ ê²€ìƒ‰ íƒ­ ì¶”ê°€ -->
<div id="tab-player-compare" class="tab-content">
<div class="input-box">
  <input type="text" id="compareSearchPlayer" placeholder="ì„ ìˆ˜ ì´ë¦„ ì…ë ¥" list="playerSuggestionsCompareSingle">
  <datalist id="playerSuggestionsCompareSingle"></datalist>
  <button id="compareSearchButton">ê²€ìƒ‰</button>
</div>

<div class="filter-box-inline" id="comparePlayerFilterBox">
  <button class="filter-btn active" data-type="êµ­ë‚´">êµ­ë‚´ ì„ ìˆ˜</button>
  <button class="filter-btn active" data-type="ì™¸êµ­ì¸">ì™¸êµ­ì¸ ì„ ìˆ˜</button>
  <button class="filter-btn active" data-type="ì•„ì‹œì•„ì¿¼í„°">ì•„ì‹œì•„ì¿¼í„°</button>
  <div style="display: flex; align-items: center; gap: 6px; margin-left: 10px;">
    <input type="checkbox" id="compareMinGamesSingle">
    <label for="compareMinGamesSingle" style="font-size: 0.75rem; color: white;">ê·œì • ê²½ê¸° ì´ìƒ(14G)</label>
  </div>
</div>
  
  <div class="category-checkboxes" id="compareStatCheckboxes">
  <div class="row">
  <label><input type="checkbox" value="ì¶œì „ ê²½ê¸° ìˆ˜"> ì¶œì „ ê²½ê¸° ìˆ˜</label>
  <label><input type="checkbox" value="ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"> í‰ê·  ì¶œì „ ì‹œê°„</label>
  <label><input type="checkbox" value="ë“ì "> ë“ì </label>
  <label><input type="checkbox" value="í‰ê·  ë“ì "> í‰ê·  ë“ì </label>
  <label><input type="checkbox" value="FGA"> FGA</label>
  <label><input type="checkbox" value="FG"> FG</label>
  <label><input type="checkbox" value="í‰ê·  FG ì‹œë„"> í‰ê·  FG ì‹œë„</label>
  <label><input type="checkbox" value="í‰ê·  FG ì„±ê³µ"> í‰ê·  FG ì„±ê³µ</label>
  <label><input type="checkbox" value="FG%"> FG%</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="2PA"> 2PA</label>
  <label><input type="checkbox" value="2P"> 2P</label>
  <label><input type="checkbox" value="í‰ê·  2p ì‹œë„"> í‰ê·  2p ì‹œë„</label>
  <label><input type="checkbox" value="í‰ê·  2p ì„±ê³µ"> í‰ê·  2p ì„±ê³µ</label>
  <label><input type="checkbox" value="2P%"> 2P%</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="3PA"> 3PA</label>
  <label><input type="checkbox" value="3P"> 3P</label>
  <label><input type="checkbox" value="í‰ê·  3p ì‹œë„"> í‰ê·  3p ì‹œë„</label>
  <label><input type="checkbox" value="í‰ê·  3p ì„±ê³µ"> í‰ê·  3p ì„±ê³µ</label>
  <label><input type="checkbox" value="3P%"> 3P%</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="FTA"> FTA</label>
  <label><input type="checkbox" value="FT"> FT</label>
  <label><input type="checkbox" value="í‰ê·  FT ì‹œë„"> í‰ê·  FT ì‹œë„</label>
  <label><input type="checkbox" value="í‰ê·  FT ì„±ê³µ"> í‰ê·  FT ì„±ê³µ</label>
  <label><input type="checkbox" value="FT%"> FT%</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="ë¦¬ë°”ìš´ë“œ"> ë¦¬ë°”ìš´ë“œ</label>
  <label><input type="checkbox" value="í‰ê·  ë¦¬ë°”ìš´ë“œ"> í‰ê·  ë¦¬ë°”ìš´ë“œ</label>
  <label><input type="checkbox" value="ê³µê²© ë¦¬ë°”ìš´ë“œ"> ê³µê²© ë¦¬ë°”ìš´ë“œ</label>
  <label><input type="checkbox" value="í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ"> í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ</label>
  <label><input type="checkbox" value="ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"> ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ</label>
  <label><input type="checkbox" value="í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"> í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="ì–´ì‹œìŠ¤íŠ¸"> ì–´ì‹œìŠ¤íŠ¸</label>
  <label><input type="checkbox" value="í‰ê·  ì–´ì‹œìŠ¤íŠ¸"> í‰ê·  ì–´ì‹œìŠ¤íŠ¸</label>
  <label><input type="checkbox" value="ìŠ¤í‹¸"> ìŠ¤í‹¸</label>
  <label><input type="checkbox" value="í‰ê·  ìŠ¤í‹¸"> í‰ê·  ìŠ¤í‹¸</label>
  <label><input type="checkbox" value="ë¸”ë¡"> ë¸”ë¡</label>
  <label><input type="checkbox" value="í‰ê·  ë¸”ë¡"> í‰ê·  ë¸”ë¡</label>
  <label><input type="checkbox" value="í„´ì˜¤ë²„"> í„´ì˜¤ë²„</label>
  <label><input type="checkbox" value="í‰ê·  í„´ì˜¤ë²„"> í‰ê·  í„´ì˜¤ë²„</label>
  <label><input type="checkbox" value="íŒŒìš¸"> íŒŒìš¸</label>
  <label><input type="checkbox" value="í‰ê·  íŒŒìš¸"> í‰ê·  íŒŒìš¸</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="WS"> WS</label>
  <label><input type="checkbox" value="WS/40"> WS/40</label>
  <label><input type="checkbox" value="Offensive_WS"> Offensive_WS</label>
  <label><input type="checkbox" value="Defensive_WS"> Defensive_WS</label>
  <label><input type="checkbox" value="PER"> PER</label>
  <label><input type="checkbox" value="EFF"> EFF</label>
  <label><input type="checkbox" value="EFF/40"> EFF/40</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="Offensive_rating"> Offensive Rating</label>
  <label><input type="checkbox" value="Defensive_rating"> Defensive Rating</label>
  <label><input type="checkbox" value="USG%"> USG%</label>
  <label><input type="checkbox" value="TS%"> TS%</label>
  <label><input type="checkbox" value="eFG%"> eFG%</label>
  <label><input type="checkbox" value="3PAr"> 3PAr</label>
  <label><input type="checkbox" value="FTr"> FTr</label>
  </div>  

  <div class="row">
  <label><input type="checkbox" value="ORB%"> ORB%</label>
  <label><input type="checkbox" value="DRB%"> DRB%</label>
  <label><input type="checkbox" value="TRB%"> TRB%</label>
  <label><input type="checkbox" value="AST%"> AST%</label>
  <label><input type="checkbox" value="STL%"> STL%</label>
  <label><input type="checkbox" value="BS%"> BS%</label>
  <label><input type="checkbox" value="TOV%"> TOV%</label>
  </div>
</div>
<div class="scroll-area">
  <div id="compareStatResults" class="stats-container">...</div>
</div>
</div>

</div>
  <footer class="footer">
    Â© 2025 The Eroom Sports. All rights reserved.
  </footer>
</div>


<script>
const statsFormats = {
  "ì¶œì „ ê²½ê¸° ìˆ˜": {unit: 'ê²½ê¸°', decimals: 0},
  "ì´ ì¶œì „ ì‹œê°„(ì´ˆ)": {unit: 'ë¶„ ì´ˆ', decimals: 0, convert: true},
  "ë“ì ": {unit: 'ì ', decimals: 0},
  "í‰ê·  ë“ì ": {unit: 'ì ', decimals: 2},
  "FGA": {unit: 'ê°œ', decimals: 0},
  "FG": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  FG ì‹œë„": {unit: 'ê°œ', decimals: 2},
  "í‰ê·  FG ì„±ê³µ": {unit: 'ê°œ', decimals: 2},
  "FG%": {unit: '%', decimals: 2},
  "2PA": {unit: 'ê°œ', decimals: 0},
  "2P": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  2p ì‹œë„": {unit: 'ê°œ', decimals: 2},
  "í‰ê·  2p ì„±ê³µ": {unit: 'ê°œ', decimals: 2},
  "2P%": {unit: '%', decimals: 2},
  "3PA": {unit: 'ê°œ', decimals: 0},
  "3P": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  3p ì‹œë„": {unit: 'ê°œ', decimals: 2},
  "í‰ê·  3p ì„±ê³µ": {unit: 'ê°œ', decimals: 2},
  "3P%": {unit: '%', decimals: 2},
  "FTA": {unit: 'ê°œ', decimals: 0},
  "FT": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  FT ì‹œë„": {unit: 'ê°œ', decimals: 2},
  "í‰ê·  FT ì„±ê³µ": {unit: 'ê°œ', decimals: 2},
  "FT%": {unit: '%', decimals: 2},
  "ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 2},
  "ê³µê²© ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 2},
  "ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ": {unit: 'ê°œ', decimals: 2},
  "ì–´ì‹œìŠ¤íŠ¸": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ì–´ì‹œìŠ¤íŠ¸": {unit: 'ê°œ', decimals: 2},
  "ìŠ¤í‹¸": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ìŠ¤í‹¸": {unit: 'ê°œ', decimals: 2},
  "ë¸”ë¡": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  ë¸”ë¡": {unit: 'ê°œ', decimals: 2},
  "í„´ì˜¤ë²„": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  í„´ì˜¤ë²„": {unit: 'ê°œ', decimals: 2},
  "íŒŒìš¸": {unit: 'ê°œ', decimals: 0},
  "í‰ê·  íŒŒìš¸": {unit: 'ê°œ', decimals: 2},
  "WS": {unit: '', decimals: 3},
  "WS/40": {unit: '', decimals: 3},
  "Offensive_WS": {unit: '', decimals: 3},
  "Defensive_WS": {unit: '', decimals: 3},
  "PER": {unit: '', decimals: 3},
  "EFF": {unit: '', decimals: 3},
  "EFF/40": {unit: '', decimals: 3},
  "Offensive_rating": {unit: '', decimals: 3},
  "Defensive_rating": {unit: '', decimals: 3},
  "TS%": {unit: '%', decimals: 3},
  "eFG%": {unit: '%', decimals: 3},
  "USG%": {unit: '%', decimals: 3},
  "3PAr": {unit: '', decimals: 3},
  "FTr": {unit: '', decimals: 3},
  "ORB%": {unit: '%', decimals: 3},
  "DRB%": {unit: '%', decimals: 3},
  "TRB%": {unit: '%', decimals: 3},
  "AST%": {unit: '%', decimals: 3},
  "STL%": {unit: '%', decimals: 3},
  "BS%": {unit: '%', decimals: 3},
  "TOV%": {unit: '%', decimals: 3}
};

function formatStatValue(key, value) {
  const format = statsFormats[key];
  if (!format) return value;

  const percentExcludedKeys = ['ORB%', 'DRB%', 'TRB%', 'AST%', 'STL%', 'BS%', 'TOV%'];

  if (key === "ì´ ì¶œì „ ì‹œê°„(ì´ˆ)" || format.unit === 'ë¶„ ì´ˆ') {
    const totalSeconds = parseInt(value, 10);
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    return `${minutes}ë¶„ ${seconds}ì´ˆ`;
  }

  let numericValue = parseFloat(value);

  // âœ… í¼ì„¼íŠ¸ í•­ëª© ë³´ì •: ê°’ì´ 1 ë¯¸ë§Œì´ë©´ 100ì„ ê³±í•´ì„œ % í˜•íƒœë¡œ ì „í™˜
  if (format.unit === '%' && !percentExcludedKeys.includes(key) && numericValue < 1.0) {
    numericValue *= 100;
  }

  const formattedValue = numericValue.toFixed(format.decimals);

  if (percentExcludedKeys.includes(key)) {
    return formattedValue; // ë‹¨ìœ„ ì œê±° ëŒ€ìƒ
  }

  return formattedValue + (format.unit !== 'ë¶„ ì´ˆ' ? format.unit : '');
}  
 const tabs = document.querySelectorAll('.tab-button');
 const contents = document.querySelectorAll('.tab-content');
 
tabs.forEach(tab => {
  tab.onclick = (e) => {
    if (e.isTrusted === false || e.detail === 0) return;

    tabs.forEach(t => t.classList.remove('active'));
    contents.forEach(c => c.classList.remove('active'));

    if (tab.dataset.tab === 'tab-compare') {
      document.getElementById('compareResult').innerHTML = '';
    }

    if (tab.dataset.tab === 'tab-player-compare') {
      document.getElementById('compareSearchPlayer').value = '';
      document.getElementById('compareStatResults').innerHTML = '';
    
      // âœ… í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ ì¬ì—°ê²°
      document.querySelectorAll('#comparePlayerFilterBox .filter-btn').forEach(btn => {
        const type = btn.dataset.type;
        btn.onclick = () => {
          if (activeTypes.has(type)) {
            activeTypes.delete(type);
            btn.classList.remove('active');
          } else {
            activeTypes.add(type);
            btn.classList.add('active');
          }
          localStorage.setItem('activeTypesComparePlayer', JSON.stringify([...activeTypes]));
          document.getElementById('compareSearchButton').click();
        };
      });
    }
    
    document.getElementById(tab.dataset.tab).classList.add('active');
    tab.classList.add('active');
  };
});

  let playerDataBySeason = {};  // âœ… ì´ ì¤„ì„ ì¶”ê°€
  let fullSeasonDataMap = {};  // â† âœ… ë°˜ë“œì‹œ ì—¬ê¸° ìœ„ì¹˜í•´ë„ ë¨
  function loadAllPlayerSuggestionsCompare() {
  const datalistIds = ['playerSuggestionsCompare1', 'playerSuggestionsCompare2', 'playerSuggestionsCompare3'];
  const seasons = ['24-25', '23-24', '22-23', '21-22', '20-21'];
  const nameSet = new Set();

  seasons.forEach(season => {
    const data = fullSeasonDataMap[season] || [];
    data.forEach(row => {
      const name = (row["Player"] || "").trim();
      if (name) nameSet.add(name);
    });
  });

  datalistIds.forEach(id => {
    const listEl = document.getElementById(id);
    if (!listEl) return;
    listEl.innerHTML = '';
    [...nameSet].sort().forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      listEl.appendChild(option);
    });
  });
}
function loadPlayerCompareSingleSuggestions() {
  const seasons = ['24-25', '23-24', '22-23', '21-22', '20-21'];
  const playerMap = new Map(); // ì´ë¦„ â†’ ê°€ì¥ ìµœì‹  ì‹œì¦Œì˜ ì „ì²´ Player ë¬¸ìì—´

  seasons.forEach(season => {
    const data = fullSeasonDataMap[season] || [];
    data.forEach(row => {
      const rawName = (row["Player"] || "").trim(); // ì˜ˆ: ê¹€ì¢…ê·œ (DB) or ê¹€ì¢…ê·œ (DB to KGC)
      const onlyName = rawName.split(' (')[0];

      // ì´ë¯¸ ì €ì¥ëœ ê²Œ ìˆë‹¤ë©´ ê±´ë„ˆë›°ê¸° (ìµœì‹  ì‹œì¦Œë¶€í„° ì§„í–‰ë¨)
      if (!playerMap.has(onlyName)) {
        playerMap.set(onlyName, rawName);
      }
    });
  });

  const datalist = document.getElementById('playerSuggestionsCompareSingle');
  if (datalist) {
    datalist.innerHTML = '';
    [...playerMap.entries()].sort().forEach(([name, full]) => {
      const option = document.createElement('option');
      option.value = name; // ì…ë ¥ì°½ì—ëŠ” ì´ë¦„ë§Œ
      option.label = full; // labelì—ëŠ” ê¹€ì¢…ê·œ (DB to KGC) ê°™ì€ ì „ì²´
      datalist.appendChild(option);
    });
  }
}


  let originalData = [], highlightedPlayer = '', fixedRow = null;
  let activeTypes = new Set(["êµ­ë‚´", "ì™¸êµ­ì¸", "ì•„ì‹œì•„ì¿¼í„°"]);
  let playersData = [];
  let playerSeasonData = {}; // ì„ ìˆ˜ë³„ ì‹œì¦Œ ë°ì´í„° ì €ì¥ìš©

 const statsLabels = [
    {label: 'ì¶œì „ ê²½ê¸° ìˆ˜', key: "ì¶œì „ ê²½ê¸° ìˆ˜", higherBetter: true},
    {label: 'í‰ê·  ì¶œì „ ì‹œê°„', key: "ì´ ì¶œì „ ì‹œê°„(ì´ˆ)", higherBetter: true},
    {label: 'ë“ì ', key: "ë“ì ", higherBetter: true},
    {label: 'í‰ê·  ë“ì ', key: "í‰ê·  ë“ì ", higherBetter: true},
    {label: 'FGA', key: "FGA", higherBetter: true},
    {label: 'FG', key: "FG", higherBetter: true},
    {label: 'í‰ê·  FG ì‹œë„', key: "í‰ê·  FG ì‹œë„", higherBetter: true},
    {label: 'í‰ê·  FG ì„±ê³µ', key: "í‰ê·  FG ì„±ê³µ", higherBetter: true},
    {label: 'FG%', key: "FG%", higherBetter: true},
    {label: '2PA', key: "2PA", higherBetter: true},
    {label: '2P', key: "2P", higherBetter: true},
    {label: 'í‰ê·  2p ì‹œë„', key: "í‰ê·  2p ì‹œë„", higherBetter: true},
    {label: 'í‰ê·  2p ì„±ê³µ', key: "í‰ê·  2p ì„±ê³µ", higherBetter: true},
    {label: '2P%', key: "2P%", higherBetter: true},
    {label: '3PA', key: "3PA", higherBetter: true},
    {label: '3P', key: "3P", higherBetter: true},
    {label: 'í‰ê·  3p ì‹œë„', key: "í‰ê·  3p ì‹œë„", higherBetter: true},
    {label: 'í‰ê·  3p ì„±ê³µ', key: "í‰ê·  3p ì„±ê³µ", higherBetter: true},
    {label: '3P%', key: "3P%", higherBetter: true},
    {label: 'FTA', key: "FTA", higherBetter: true},
    {label: 'FT', key: "FT", higherBetter: true},
    {label: 'í‰ê·  FT ì‹œë„', key: "í‰ê·  FT ì‹œë„", higherBetter: true},
    {label: 'í‰ê·  FT ì„±ê³µ', key: "í‰ê·  FT ì„±ê³µ", higherBetter: true},
    {label: 'FT%', key: "FT%", higherBetter: true},
    {label: 'ë¦¬ë°”ìš´ë“œ', key: "ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'í‰ê·  ë¦¬ë°”ìš´ë“œ', key: "í‰ê·  ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'ê³µê²© ë¦¬ë°”ìš´ë“œ', key: "ê³µê²© ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ', key: "í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ', key: "ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ', key: "í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", higherBetter: true},
    {label: 'ì–´ì‹œìŠ¤íŠ¸', key: "ì–´ì‹œìŠ¤íŠ¸", higherBetter: true},
    {label: 'í‰ê·  ì–´ì‹œìŠ¤íŠ¸', key: "í‰ê·  ì–´ì‹œìŠ¤íŠ¸", higherBetter: true},
    {label: 'ìŠ¤í‹¸', key: "ìŠ¤í‹¸", higherBetter: true},
    {label: 'í‰ê·  ìŠ¤í‹¸', key: "í‰ê·  ìŠ¤í‹¸", higherBetter: true},
    {label: 'ë¸”ë¡', key: "ë¸”ë¡", higherBetter: true},
    {label: 'í‰ê·  ë¸”ë¡', key: "í‰ê·  ë¸”ë¡", higherBetter: true},
    {label: 'í„´ì˜¤ë²„', key: "í„´ì˜¤ë²„", higherBetter: false},
    {label: 'í‰ê·  í„´ì˜¤ë²„', key: "í‰ê·  í„´ì˜¤ë²„", higherBetter: false},
    {label: 'íŒŒìš¸', key: "íŒŒìš¸", higherBetter: false},
    {label: 'í‰ê·  íŒŒìš¸', key: "í‰ê·  íŒŒìš¸", higherBetter: false},
    {label: 'WS', key: "WS", higherBetter: true},
    {label: 'WS/40', key: "WS/40", higherBetter: true},
    {label: 'Offensive_WS', key: "Offensive_WS", higherBetter: true},
    {label: 'Defensive_WS', key: "Defensive_WS", higherBetter: true},
    {label: 'Offensive_rating', key: "Offensive_rating", higherBetter: true},
    {label: 'Defensive_rating', key: "Defensive_rating", higherBetter: false},
    {label: 'PER', key: "PER", higherBetter: true},
    {label: 'EFF', key: "EFF", higherBetter: true},
    {label: 'EFF/40', key: "EFF/40", higherBetter: true},
    {label: 'TS%', key: "TS%", higherBetter: true},
    {label: 'eFG%', key: "eFG%", higherBetter: true},
    {label: 'USG%', key: "USG%", higherBetter: true},
    {label: '3PAr', key: "3PAr", higherBetter: true},
    {label: 'FTr', key: "FTr", higherBetter: true},
    {label: 'ORB%', key: "ORB%", higherBetter: true},
    {label: 'DRB%', key: "DRB%", higherBetter: true},
    {label: 'TRB%', key: "TRB%", higherBetter: true},
    {label: 'AST%', key: "AST%", higherBetter: true},
    {label: 'STL%', key: "STL%", higherBetter: true},
    {label: 'BS%', key: "BS%", higherBetter: true},
    {label: 'TOV%', key: "TOV%", higherBetter: false}
  ];  
window.renderTable = renderTable; // âœ… ì—¬ê¸°ì— ì´ ì¤„ ì¶”ê°€
  
async function loadPlayersData() {
  const season = document.getElementById('seasonSelector')?.value || '24-25'; // â† ì´ ë¶€ë¶„ë„ ìˆ˜ì •
  const fileMap = {
    '20-21': '20-21_KBL_stats.xlsx', // âœ… ì¶”ê°€
    '21-22': '21-22_KBL_stats.xlsx', // âœ… ì´ ì¤„ ì¶”ê°€
    '22-23': '22-23_KBL_stats.xlsx', // âœ… ì¶”ê°€
    '23-24': '23-24_KBL_stats.xlsx',
    '24-25': '24-25_KBL_stats.xlsx'
  };
  const url = `https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`;

try {
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error(`HTTP ${response.status} - ${response.statusText}`);
  }

  const data = await response.arrayBuffer();
  const workbook = XLSX.read(data, { type: "array" });
  const firstSheet = workbook.SheetNames[0];
  originalData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet]);

originalData.forEach(cols => {
  let minutes = parseInt(cols["m"]) || 0;
  let seconds = parseInt(cols["s"]) || 0;
  cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = minutes * 60 + seconds;

  const name = (cols["Player"] || "").trim();
  const team = (cols["Team"] || "").trim();
  cols["Player"] = `${name} (${team})`;  // âœ… ì™„ì „í•œ ì´ë¦„(íŒ€ëª…)ìœ¼ë¡œ êµì²´
  cols["Team"] = team;
  cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
});
fullSeasonDataMap[season] = originalData;

// âœ… ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ ì±„ìš°ê¸°
const suggestionSet = new Set();
originalData.forEach(cols => {
  const name = (cols["Player"] || "").trim();  // ì´ë¯¸ "ê³½ì •í›ˆ (ëŒ€êµ¬ ê°€ìŠ¤ê³µì‚¬)" í˜•ì‹ì„
  if (name) {
    suggestionSet.add(name);
  }
});
const datalist = document.getElementById("playerSuggestionsAll");
if (datalist) {
  datalist.innerHTML = "";
  [...suggestionSet].sort().forEach(item => {
    const option = document.createElement("option");
    option.value = item;
    datalist.appendChild(option);
  });
}

renderTable(originalData);
loadAllPlayerSuggestionsCompare(); // ì „ì²´ ì‹œì¦Œ ë°ì´í„° ë‹¤ ë°›ì€ í›„ í˜¸ì¶œí•´ì•¼ ìë™ì™„ì„± ì±„ì›Œì§
  
  
} catch (error) {
  console.error("ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:", error);
  alert(`ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`);
}


function renderTable(data) {
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  const minGamesOnly = document.getElementById('minGamesCheckbox').checked;
  const filteredData = data.filter(cols =>
    activeTypes.has(cols["êµ¬ë¶„"]) &&
    (!minGamesOnly || parseInt(cols["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14)
  );
  filteredData.forEach(cols => {
    const playerName = cols["Player"];
    const status = parseInt(cols["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14 ? 'âœ…' : 'âš ï¸';
    const totalSeconds = cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"]; // ì´ë¯¸ ê³„ì‚°ëœ ê°’ ì •í™•íˆ ì‚¬ìš©

    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;

const row = document.createElement('tr');
row.innerHTML = `
  <td>${playerName} <span class="${cols["ì¶œì „ ê²½ê¸° ìˆ˜"] >= 20 ? 'valid' : 'warning'}">${status}</span></td>
  <td>${cols["Team"]}</td>
  <td>${formatStatValue("ì¶œì „ ê²½ê¸° ìˆ˜", cols["ì¶œì „ ê²½ê¸° ìˆ˜"])}</td>
  <td data-time="${totalSeconds}">${formatStatValue("ì´ ì¶œì „ ì‹œê°„(ì´ˆ)", totalSeconds)}</td>
  <td>${formatStatValue("ë“ì ", cols["ë“ì "])}</td>
  <td>${formatStatValue("í‰ê·  ë“ì ", cols["í‰ê·  ë“ì "])}</td>
  <td>${formatStatValue("FGA", cols["FGA"])}</td>
  <td>${formatStatValue("FG", cols["FG"])}</td>
  <td>${formatStatValue("í‰ê·  FG ì‹œë„", cols["í‰ê·  FG ì‹œë„"])}</td>
  <td>${formatStatValue("í‰ê·  FG ì„±ê³µ", cols["í‰ê·  FG ì„±ê³µ"])}</td>
  <td>${formatStatValue("FG%", cols["FG%"])}</td>
  <td>${formatStatValue("2PA", cols["2PA"])}</td>
  <td>${formatStatValue("2P", cols["2P"])}</td>
  <td>${formatStatValue("í‰ê·  2p ì‹œë„", cols["í‰ê·  2p ì‹œë„"])}</td>
  <td>${formatStatValue("í‰ê·  2p ì„±ê³µ", cols["í‰ê·  2p ì„±ê³µ"])}</td>
  <td>${formatStatValue("2P%", cols["2P%"])}</td>
  <td>${formatStatValue("3PA", cols["3PA"])}</td>
  <td>${formatStatValue("3P", cols["3P"])}</td>
  <td>${formatStatValue("í‰ê·  3p ì‹œë„", cols["í‰ê·  3p ì‹œë„"])}</td>
  <td>${formatStatValue("í‰ê·  3p ì„±ê³µ", cols["í‰ê·  3p ì„±ê³µ"])}</td>
  <td>${formatStatValue("3P%", cols["3P%"])}</td>
  <td>${formatStatValue("FTA", cols["FTA"])}</td>
  <td>${formatStatValue("FT", cols["FT"])}</td>
  <td>${formatStatValue("í‰ê·  FT ì‹œë„", cols["í‰ê·  FT ì‹œë„"])}</td>
  <td>${formatStatValue("í‰ê·  FT ì„±ê³µ", cols["í‰ê·  FT ì„±ê³µ"])}</td>
  <td>${formatStatValue("FT%", cols["FT%"])}</td>
  <td>${formatStatValue("ë¦¬ë°”ìš´ë“œ", cols["ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("í‰ê·  ë¦¬ë°”ìš´ë“œ", cols["í‰ê·  ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("ê³µê²© ë¦¬ë°”ìš´ë“œ", cols["ê³µê²© ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ", cols["í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", cols["ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", cols["í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"])}</td>
  <td>${formatStatValue("ì–´ì‹œìŠ¤íŠ¸", cols["ì–´ì‹œìŠ¤íŠ¸"])}</td>
  <td>${formatStatValue("í‰ê·  ì–´ì‹œìŠ¤íŠ¸", cols["í‰ê·  ì–´ì‹œìŠ¤íŠ¸"])}</td>
  <td>${formatStatValue("ìŠ¤í‹¸", cols["ìŠ¤í‹¸"])}</td>
  <td>${formatStatValue("í‰ê·  ìŠ¤í‹¸", cols["í‰ê·  ìŠ¤í‹¸"])}</td>
  <td>${formatStatValue("ë¸”ë¡", cols["ë¸”ë¡"])}</td>
  <td>${formatStatValue("í‰ê·  ë¸”ë¡", cols["í‰ê·  ë¸”ë¡"])}</td>
  <td>${formatStatValue("í„´ì˜¤ë²„", cols["í„´ì˜¤ë²„"])}</td>
  <td>${formatStatValue("í‰ê·  í„´ì˜¤ë²„", cols["í‰ê·  í„´ì˜¤ë²„"])}</td>
  <td>${formatStatValue("íŒŒìš¸", cols["íŒŒìš¸"])}</td>
  <td>${formatStatValue("í‰ê·  íŒŒìš¸", cols["í‰ê·  íŒŒìš¸"])}</td>
  <td>${formatStatValue("WS", cols["WS"])}</td>
  <td>${formatStatValue("WS/40", cols["WS/40"])}</td>
  <td>${formatStatValue("Offensive_WS", cols["Offensive_WS"])}</td>
  <td>${formatStatValue("Defensive_WS", cols["Defensive_WS"])}</td>
  <td>${formatStatValue("PER", cols["PER"])}</td>
  <td>${formatStatValue("EFF", cols["EFF"])}</td>
  <td>${formatStatValue("EFF/40", cols["EFF/40"])}</td>
  <td>${formatStatValue("Offensive_rating", cols["Offensive_rating"])}</td>
  <td>${formatStatValue("Defensive_rating", cols["Defensive_rating"])}</td>
  <td>${formatStatValue("USG%", cols["USG%"])}</td>
  <td>${formatStatValue("TS%", cols["TS%"])}</td>
  <td>${formatStatValue("eFG%", cols["eFG%"])}</td>
  <td>${formatStatValue("3PAr", cols["3PAr"])}</td>
  <td>${formatStatValue("FTr", cols["FTr"])}</td>
  <td>${formatStatValue("ORB%", cols["ORB%"])}</td>
  <td>${formatStatValue("DRB%", cols["DRB%"])}</td>
  <td>${formatStatValue("TRB%", cols["TRB%"])}</td>
  <td>${formatStatValue("AST%", cols["AST%"])}</td>
  <td>${formatStatValue("STL%", cols["STL%"])}</td>
  <td>${formatStatValue("BS%", cols["BS%"])}</td>
  <td>${formatStatValue("TOV%", cols["TOV%"])}</td>
`;
tableBody.appendChild(row);
  });
// âœ… í‘¸í„° ì—¬ë°± í™•ë³´ìš© ë§ˆì§€ë§‰ ë¹ˆ í–‰ ì¶”ê°€
const spacerRow = document.createElement('tr');
spacerRow.id = 'spacerRow';
spacerRow.innerHTML = `<td style="padding: 0; height: 80px; background: transparent; border: none;" colspan="${document.querySelectorAll('#statsTable thead th').length}"></td>`;
tableBody.appendChild(spacerRow);
}

window.renderTable = renderTable; // âœ… ì—¬ê¸° ìˆì–´ì•¼ë§Œ ì‘ë™í•¨
function updateCompareAutocomplete(playerIdx) {
  const season = document.getElementById(`compareSeason${playerIdx}`)?.value || '24-25';
  const datalist = document.getElementById(`playerSuggestionsCompare${playerIdx}`);
  if (!datalist) return;

  const data = fullSeasonDataMap[season] || [];
  const nameSet = new Set();

  data.forEach(row => {
    const name = (row["Player"] || "").trim();
    if (name) nameSet.add(name);
  });

  datalist.innerHTML = '';
  [...nameSet].sort().forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    datalist.appendChild(option);
  });
}
 
function searchPlayer(inputOverride = null){
  const rawInput = (inputOverride || document.getElementById('searchPlayerAll').value).trim().toLowerCase();

  clearFixedRow();
  const rows = document.querySelectorAll('#tableBody tr');
  let found = false;
  rows.forEach(row => {
    const nameCell = row.cells[0];
    const rawText = nameCell?.childNodes[0]?.nodeValue?.trim().toLowerCase(); // âœ… ì´ë¦„ë§Œ ì¶”ì¶œ (âœ…/âš ï¸ ì œê±°)
    row.classList.remove('highlight');

    if (rawText === rawInput) {
      found = true;
      row.classList.add('highlight');
      fixRow(row);
    }
  });

  if (!found) alert("Player not found!");
}

window.searchPlayer = searchPlayer;

 function fixRow(row) {
  clearFixedRow();
  fixedRow = row.cloneNode(true);
  fixedRow.classList.add('fixed-row', 'highlight');
  fixedRow.style.position = 'sticky';
  fixedRow.style.top = '34px';
  fixedRow.style.backgroundColor = '#000';
  fixedRow.style.zIndex = '500';

  const releaseBtn = document.createElement('button');
  releaseBtn.textContent = 'í•´ì œ';
  releaseBtn.style.marginLeft = '10px';
  releaseBtn.onclick = () => {
    clearFixedRow();
    document.getElementById('searchPlayerAll').value = "";
  };

  fixedRow.cells[0].appendChild(releaseBtn);
  document.querySelector('#statsTable thead').after(fixedRow);
}

function clearFixedRow() {
  if (fixedRow) {
    const originalRows = document.querySelectorAll('#tableBody tr');
    originalRows.forEach(row => row.classList.remove('highlight'));
    fixedRow.remove();
  }
  fixedRow = null;
}

  
 document.getElementById('minGamesCheckbox').addEventListener('change', function() {
   renderTable(originalData);
 });

function calculateRank(data, statKey, playerValue, isHigherBetter = true) {
  const validValues = data
    .map(cols => parseFloat(cols[statKey]))
    .filter(value => !isNaN(value));

  if (validValues.length === 0 || isNaN(parseFloat(playerValue))) {
    return '-'; // ë°ì´í„° ì—†ê±°ë‚˜ ê°’ì´ NaNì¼ ê²½ìš°
  }

  const sorted = [...validValues].sort((a, b) => isHigherBetter ? b - a : a - b);
  const rank = sorted.indexOf(parseFloat(playerValue)) + 1;
  return rank || '-';
}

function showPlayerStats() {
const season = document.getElementById('seasonSelectorPlayer')?.value || '24-25';
  let playerNameInput = document.getElementById('searchPlayer').value.trim();

  // âœ… ê´„í˜¸ ì¤‘ë³µ ì œê±° (ì˜ˆ: "í™ê¸¸ë™ (KGC) (KGC)" â†’ "í™ê¸¸ë™ (KGC)")
  const matches = playerNameInput.match(/\(([^)]+)\)/g);
  if (matches && matches.length > 1) {
    const namePart = playerNameInput.split('(')[0].trim();
    const teamPart = matches[0].replace(/[()]/g, '').trim();
    playerNameInput = `${namePart} (${teamPart})`;
  }
  
const minGamesChecked = document.getElementById('minGames').checked;
const data = fullSeasonDataMap[season] || originalData;  // âœ… ì‹œì¦Œë³„ ë°ì´í„° ê¸°ë°˜
const filteredData = data.filter(cols => {
  const isTypeMatched = activeTypes.has(cols["êµ¬ë¶„"]);
  const isMinGames = !minGamesChecked || parseInt(cols["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14;
  return isTypeMatched && isMinGames;
});
  
const playerData = filteredData.find(cols => {
  const fullName = cols["Player"].trim().toLowerCase();
  const input = playerNameInput.toLowerCase();
  return fullName === input;
});

  if (playerData) {
    const seasonKor = {
      "20-21": "20-21 ì‹œì¦Œ",
      "21-22": "21-22 ì‹œì¦Œ",
      "22-23": "22-23 ì‹œì¦Œ",
      "23-24": "23-24 ì‹œì¦Œ",
      "24-25": "24-25 ì‹œì¦Œ"
    };
    const seasonName = seasonKor[season] || season;
    const playerTeamName = playerData["Player"];
    document.getElementById('playerTitle').innerHTML = `<span style="font-size: 1.2rem; color: #AAA;">${seasonName}</span> ${playerTeamName}`;
    document.getElementById('playerFilterBox').style.display = 'flex';
    document.getElementById('statsContainer').style.display = 'grid';
  
    const statsContainer = document.getElementById('statsContainer');
    statsContainer.innerHTML = '';

    statsContainer.innerHTML += createCard('ê¸°ë³¸ ì •ë³´', [
      {label: 'ì¶œì „ ê²½ê¸° ìˆ˜', value: formatStatValue("ì¶œì „ ê²½ê¸° ìˆ˜", playerData["ì¶œì „ ê²½ê¸° ìˆ˜"]), rank: calculateRank(filteredData, "ì¶œì „ ê²½ê¸° ìˆ˜", playerData["ì¶œì „ ê²½ê¸° ìˆ˜"], true) + 'ìœ„'},
      {label: 'í‰ê·  ì¶œì „ ì‹œê°„', value: formatStatValue("ì´ ì¶œì „ ì‹œê°„(ì´ˆ)", playerData["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"]), rank: calculateRank(filteredData, "ì´ ì¶œì „ ì‹œê°„(ì´ˆ)", playerData["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"], true) + 'ìœ„'},
      {label: 'ì´ ë“ì ', value: formatStatValue("ë“ì ", playerData["ë“ì "]), rank: calculateRank(filteredData, "ë“ì ", playerData["ë“ì "], true) + 'ìœ„'},
      {label: 'í‰ê·  ë“ì ', value: formatStatValue("í‰ê·  ë“ì ", playerData["í‰ê·  ë“ì "]), rank: calculateRank(filteredData, "í‰ê·  ë“ì ", playerData["í‰ê·  ë“ì "], true) + 'ìœ„'}
    ], 'primary');

statsContainer.innerHTML += createCard('ìŠˆíŒ… ì§€í‘œ', [
      {label: 'í‰ê·  FG ì‹œë„', value: formatStatValue("í‰ê·  FG ì‹œë„", playerData["í‰ê·  FG ì‹œë„"]), rank: calculateRank(filteredData, "í‰ê·  FG ì‹œë„", playerData["í‰ê·  FG ì‹œë„"], true) + 'ìœ„'},
      {label: 'í‰ê·  FG ì„±ê³µ', value: formatStatValue("í‰ê·  FG ì„±ê³µ", playerData["í‰ê·  FG ì„±ê³µ"]), rank: calculateRank(filteredData, "í‰ê·  FG ì„±ê³µ", playerData["í‰ê·  FG ì„±ê³µ"], true) + 'ìœ„'},
      {label: 'í‰ê·  2p ì‹œë„', value: formatStatValue("í‰ê·  2p ì‹œë„", playerData["í‰ê·  2p ì‹œë„"]), rank: calculateRank(filteredData, "í‰ê·  2p ì‹œë„", playerData["í‰ê·  2p ì‹œë„"], true) + 'ìœ„'},
      {label: 'í‰ê·  2p ì„±ê³µ', value: formatStatValue("í‰ê·  2p ì„±ê³µ", playerData["í‰ê·  2p ì„±ê³µ"]), rank: calculateRank(filteredData, "í‰ê·  2p ì„±ê³µ", playerData["í‰ê·  2p ì„±ê³µ"], true) + 'ìœ„'},
      {label: 'í‰ê·  3p ì„±ê³µ', value: formatStatValue("í‰ê·  3p ì„±ê³µ", playerData["í‰ê·  3p ì„±ê³µ"]), rank: calculateRank(filteredData, "í‰ê·  3p ì„±ê³µ", playerData["í‰ê·  3p ì„±ê³µ"], true) + 'ìœ„'},
      {label: 'í‰ê·  FT ì‹œë„', value: formatStatValue("í‰ê·  FT ì‹œë„", playerData["í‰ê·  FT ì‹œë„"]), rank: calculateRank(filteredData, "í‰ê·  FT ì‹œë„", playerData["í‰ê·  FT ì‹œë„"], true) + 'ìœ„'},
      {label: 'í‰ê·  FT ì„±ê³µ', value: formatStatValue("í‰ê·  FT ì„±ê³µ", playerData["í‰ê·  FT ì„±ê³µ"]), rank: calculateRank(filteredData, "í‰ê·  FT ì„±ê³µ", playerData["í‰ê·  FT ì„±ê³µ"], true) + 'ìœ„'}
], 'primary');

statsContainer.innerHTML += createCard('ìŠˆíŒ… ì„±ê³µë¥ ', [
  {
    label: 'FG%', 
    value: formatStatValue("FG%", playerData["FG%"]), 
    rank: calculateRank(filteredData, "FG%", playerData["FG%"], true) + 'ìœ„'
  },
  {
    label: '2P%', 
    value: formatStatValue("2P%", playerData["2P%"]), 
    rank: calculateRank(filteredData, "2P%", playerData["2P%"], true) + 'ìœ„'
  },
  {
    label: '3P%', 
    value: formatStatValue("3P%", playerData["3P%"]), 
    rank: calculateRank(filteredData, "3P%", playerData["3P%"], true) + 'ìœ„'
  },
  {
    label: 'FT%', 
    value: formatStatValue("FT%", playerData["FT%"]), 
    rank: calculateRank(filteredData, "FT%", playerData["FT%"], true) + 'ìœ„'
  }
], 'primary');

statsContainer.innerHTML += createCard('ë¦¬ë°”ìš´ë“œ ì§€í‘œ', [
  {
    label: 'ì´ ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("ë¦¬ë°”ìš´ë“œ", playerData["ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "ë¦¬ë°”ìš´ë“œ", playerData["ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„',
    highlight: true
  },
  {
    label: 'í‰ê·  ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("í‰ê·  ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "í‰ê·  ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„',
    highlight: true
  },
  {
    label: 'ê³µê²© ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("ê³µê²© ë¦¬ë°”ìš´ë“œ", playerData["ê³µê²© ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "ê³µê²© ë¦¬ë°”ìš´ë“œ", playerData["ê³µê²© ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„'
  },
  {
    label: 'í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„'
  },
  {
    label: 'ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", playerData["ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", playerData["ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„'
  },
  {
    label: 'í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ', 
    value: formatStatValue("í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"]), 
    rank: calculateRank(filteredData, "í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ", playerData["í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ"], true) + 'ìœ„'
  }
], 'primary');

statsContainer.innerHTML += createCard('ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ', [
  {
    label: 'ì´ ì–´ì‹œìŠ¤íŠ¸', 
    value: formatStatValue("ì–´ì‹œìŠ¤íŠ¸", playerData["ì–´ì‹œìŠ¤íŠ¸"]), 
    rank: calculateRank(filteredData, "ì–´ì‹œìŠ¤íŠ¸", playerData["ì–´ì‹œìŠ¤íŠ¸"], true) + 'ìœ„'
  },
  {
    label: 'í‰ê·  ì–´ì‹œìŠ¤íŠ¸', 
    value: formatStatValue("í‰ê·  ì–´ì‹œìŠ¤íŠ¸", playerData["í‰ê·  ì–´ì‹œìŠ¤íŠ¸"]), 
    rank: calculateRank(filteredData, "í‰ê·  ì–´ì‹œìŠ¤íŠ¸", playerData["í‰ê·  ì–´ì‹œìŠ¤íŠ¸"], true) + 'ìœ„'
  },
  {
    label: 'ì´ ìŠ¤í‹¸', 
    value: formatStatValue("ìŠ¤í‹¸", playerData["ìŠ¤í‹¸"]), 
    rank: calculateRank(filteredData, "ìŠ¤í‹¸", playerData["ìŠ¤í‹¸"], true) + 'ìœ„'
  },
  {
    label: 'í‰ê·  ìŠ¤í‹¸', 
    value: formatStatValue("í‰ê·  ìŠ¤í‹¸", playerData["í‰ê·  ìŠ¤í‹¸"]), 
    rank: calculateRank(filteredData, "í‰ê·  ìŠ¤í‹¸", playerData["í‰ê·  ìŠ¤í‹¸"], true) + 'ìœ„'
  },
  {
    label: 'ì´ ë¸”ë¡', 
    value: formatStatValue("ë¸”ë¡", playerData["ë¸”ë¡"]), 
    rank: calculateRank(filteredData, "ë¸”ë¡", playerData["ë¸”ë¡"], true) + 'ìœ„'
  },
  {
    label: 'í‰ê·  ë¸”ë¡', 
    value: formatStatValue("í‰ê·  ë¸”ë¡", playerData["í‰ê·  ë¸”ë¡"]), 
    rank: calculateRank(filteredData, "í‰ê·  ë¸”ë¡", playerData["í‰ê·  ë¸”ë¡"], true) + 'ìœ„'
  }
], 'primary');

statsContainer.innerHTML += createCard('ê¸°íƒ€ ì§€í‘œ', [
  {
    label: 'í„´ì˜¤ë²„', 
    value: formatStatValue("í„´ì˜¤ë²„", playerData["í„´ì˜¤ë²„"]), 
    rank: calculateRank(filteredData, "í„´ì˜¤ë²„", playerData["í„´ì˜¤ë²„"], false) + 'ìœ„'
  },
  {
    label: 'í‰ê·  í„´ì˜¤ë²„', 
    value: formatStatValue("í‰ê·  í„´ì˜¤ë²„", playerData["í‰ê·  í„´ì˜¤ë²„"]), 
    rank: calculateRank(filteredData, "í‰ê·  í„´ì˜¤ë²„", playerData["í‰ê·  í„´ì˜¤ë²„"], false) + 'ìœ„'
  },
  {
    label: 'íŒŒìš¸', 
    value: formatStatValue("íŒŒìš¸", playerData["íŒŒìš¸"]), 
    rank: calculateRank(filteredData, "íŒŒìš¸", playerData["íŒŒìš¸"], false) + 'ìœ„'
  },
  {
    label: 'í‰ê·  íŒŒìš¸', 
    value: formatStatValue("í‰ê·  íŒŒìš¸", playerData["í‰ê·  íŒŒìš¸"]), 
    rank: calculateRank(filteredData, "í‰ê·  íŒŒìš¸", playerData["í‰ê·  íŒŒìš¸"], false) + 'ìœ„'
  }
], 'primary');



statsContainer.innerHTML += createCard('WinShare ì§€í‘œ', [
  {label: 'WS', value: formatStatValue("WS", playerData["WS"]), rank: calculateRank(filteredData, "WS", playerData["WS"], true) + 'ìœ„', highlight: true},
  {label: 'WS/40', value: formatStatValue("WS/40", playerData["WS/40"]), rank: calculateRank(filteredData, "WS/40", playerData["WS/40"], true) + 'ìœ„'},
  {label: 'Offensive_WS', value: formatStatValue("Offensive_WS", playerData["Offensive_WS"]), rank: calculateRank(filteredData, "Offensive_WS", playerData["Offensive_WS"], true) + 'ìœ„'},
  {label: 'Defensive_WS', value: formatStatValue("Defensive_WS", playerData["Defensive_WS"]), rank: calculateRank(filteredData, "Defensive_WS", playerData["Defensive_WS"], true) + 'ìœ„'}
], 'secondary');

statsContainer.innerHTML += createCard('íš¨ìœ¨ì„± ì§€í‘œ', [
  {label: 'PER', value: formatStatValue("PER", playerData["PER"]), rank: calculateRank(filteredData, "PER", playerData["PER"], true) + 'ìœ„'},
  {label: 'EFF', value: formatStatValue("EFF", playerData["EFF"]), rank: calculateRank(filteredData, "EFF", playerData["EFF"], true) + 'ìœ„'},
  {label: 'EFF/40', value: formatStatValue("EFF/40", playerData["EFF/40"]), rank: calculateRank(filteredData, "EFF/40", playerData["EFF/40"], true) + 'ìœ„'},
  {label: 'Offensive_rating', value: formatStatValue("Offensive_rating", playerData["Offensive_rating"]), rank: calculateRank(filteredData, "Offensive_rating", playerData["Offensive_rating"], true) + 'ìœ„'},
  {label: 'Defensive_rating', value: formatStatValue("Defensive_rating", playerData["Defensive_rating"]), rank: calculateRank(filteredData, "Defensive_rating", playerData["Defensive_rating"], false) + 'ìœ„'},
  {label: 'USG%', value: formatStatValue("USG%", playerData["USG%"]), rank: calculateRank(filteredData, "USG%", playerData["USG%"], true) + 'ìœ„'}
], 'secondary');

statsContainer.innerHTML += createCard('2ì°¨ ìŠˆíŒ… ì§€í‘œ', [
  {label: 'TS%', value: formatStatValue("TS%", playerData["TS%"]), rank: calculateRank(filteredData, "TS%", playerData["TS%"], true) + 'ìœ„'},
  {label: 'eFG%', value: formatStatValue("eFG%", playerData["eFG%"]), rank: calculateRank(filteredData, "eFG%", playerData["eFG%"], true) + 'ìœ„'},
  {label: '3PAr', value: formatStatValue("3PAr", playerData["3PAr"]), rank: calculateRank(filteredData, "3PAr", playerData["3PAr"], true) + 'ìœ„'},
  {label: 'FTr', value: formatStatValue("FTr", playerData["FTr"]), rank: calculateRank(filteredData, "FTr", playerData["FTr"], true) + 'ìœ„'}
], 'secondary');

statsContainer.innerHTML += createCard('Teamë‚´ ë¹„ì¤‘ ì§€í‘œ', [
  {label: 'ORB%', value: formatStatValue("ORB%", playerData["ORB%"]), rank: calculateRank(filteredData, "ORB%", playerData["ORB%"], true) + 'ìœ„'},
  {label: 'DRB%', value: formatStatValue("DRB%", playerData["DRB%"]), rank: calculateRank(filteredData, "DRB%", playerData["DRB%"], true) + 'ìœ„'},
  {label: 'TRB%', value: formatStatValue("TRB%", playerData["TRB%"]), rank: calculateRank(filteredData, "TRB%", playerData["TRB%"], true) + 'ìœ„'},
  {label: 'AST%', value: formatStatValue("AST%", playerData["AST%"]), rank: calculateRank(filteredData, "AST%", playerData["AST%"], true) + 'ìœ„'},
  {label: 'STL%', value: formatStatValue("STL%", playerData["STL%"]), rank: calculateRank(filteredData, "STL%", playerData["STL%"], true) + 'ìœ„'},
  {label: 'BS%', value: formatStatValue("BS%", playerData["BS%"]), rank: calculateRank(filteredData, "BS%", playerData["BS%"], true) + 'ìœ„'},
  {label: 'TOV%', value: formatStatValue("TOV%", playerData["TOV%"]), rank: calculateRank(filteredData, "TOV%", playerData["TOV%"], false) + 'ìœ„'}
], 'team-stats');

const spacer = document.createElement('div');
spacer.style.height = '0px';
statsContainer.appendChild(spacer);



  } else {
    alert('ì„ ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
  }
}
let lastConfirmedInput = '';

document.getElementById('searchPlayerAll').addEventListener('input', function(e) {
  lastConfirmedInput = e.target.value.trim().toLowerCase();
});
  
document.getElementById('searchPlayerAll').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    setTimeout(() => {
      const value = document.getElementById('searchPlayerAll').value.trim().toLowerCase();
      searchPlayer(value);  // âœ… í™•ì •ëœ ì…ë ¥ê°’ì„ ì‚¬ìš©
    }, 100);  // â† ê¸°ì¡´ 10 â†’ 30msë¡œ ë³€ê²½
  }
});

function createCard(title, stats, type = 'primary') {
  return `
    <div class="card ${type}">
      <h3>${title}</h3>
      <table>
        <thead>
          <tr>
            <th>ì§€í‘œ</th>
            <th>ê¸°ë¡</th>
            <th>ìˆœìœ„</th>
          </tr>
        </thead>
        <tbody>
          ${stats.map(stat => `
            <tr>
              <td>${stat.label}</td>
              <td>${stat.value}</td>
              <td>${stat.rank}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}


// ê°œì¸ ì„ ìˆ˜ íƒ­ ê²€ìƒ‰ì°½ì—ì„œ ì—”í„° í‚¤ ë™ì‘
document.getElementById('searchPlayer').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    showPlayerStats();
  }
});
document.getElementById('searchPlayerButton').addEventListener('click', showPlayerStats);

// âœ… ì„ ìˆ˜ ê°œì¸ ê²€ìƒ‰ í˜ì´ì§€ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì¶”ê°€ (ì™„ë²½í•´ê²°)
document.getElementById('minGames').addEventListener('change', function() {
  const playerInput = document.getElementById('searchPlayer').value.trim();
  if (playerInput !== "") {
    showPlayerStats();  // Player ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ë‹¤ì‹œ ê²€ìƒ‰
  }
});


window.comparePlayers = async function () {
  tabs.forEach(t => t.classList.remove('active'));
  contents.forEach(c => c.classList.remove('active'));
  document.querySelector('[data-tab="tab-compare"]').classList.add('active');
  document.getElementById('tab-compare').classList.add('active');

const player1 = document.getElementById('comparePlayer1').value.trim();
const player2 = document.getElementById('comparePlayer2').value.trim();
const player3 = document.getElementById('comparePlayer3').value.trim();
const minGamesChecked = document.getElementById('compareMinGames').checked;

if (!player1 && !player2 && !player3) {
  document.getElementById('compareResult').innerHTML = '';
  return;
}

playersData = await Promise.all(
  [player1, player2, player3].filter(name => name !== '').map(async (name, idx) => {
    const seasonSelector = document.getElementById(`seasonSwitch-${idx}`);
    const season = seasonSelector ? seasonSelector.value : '24-25';

    let seasonData = fullSeasonDataMap[season];
    if (!seasonData) {
      const fileMap = {
        '20-21': '20-21_KBL_stats.xlsx',
        '21-22': '21-22_KBL_stats.xlsx',
        '22-23': '22-23_KBL_stats.xlsx',
        '23-24': '23-24_KBL_stats.xlsx',
        '24-25': '24-25_KBL_stats.xlsx'
      };
      const res = await fetch(`https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`);
      const data = await res.arrayBuffer();
      const workbook = XLSX.read(data, { type: "array" });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      seasonData = XLSX.utils.sheet_to_json(sheet);

      seasonData.forEach(cols => {
        const m = parseInt(cols["m"]) || 0;
        const s = parseInt(cols["s"]) || 0;
        cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = m * 60 + s;
        const rawPlayer = (cols["Player"] || "").trim();
        const team = (cols["Team"] || "").trim();
        cols["Player"] = `${rawPlayer} (${team})`;
        cols["Team"] = team;
        cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
      });

      fullSeasonDataMap[season] = seasonData;
    }

const seasons = ['24-25', '23-24', '22-23', '21-22', '20-21'];
let matched;
for (const s of seasons) {
  let data = fullSeasonDataMap[s];
  if (!data) {
    const res = await fetch(`https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[s]}`);
    const buffer = await res.arrayBuffer();
    const workbook = XLSX.read(buffer, { type: "array" });
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    data = XLSX.utils.sheet_to_json(sheet);
    data.forEach(cols => {
      const m = parseInt(cols["m"]) || 0;
      const sec = parseInt(cols["s"]) || 0;
      cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = m * 60 + sec;
      const raw = (cols["Player"] || "").trim();
      const team = (cols["Team"] || "").trim();
      cols["Player"] = `${raw} (${team})`;
      cols["Team"] = team;
      cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
    });
    fullSeasonDataMap[s] = data;
  }
  matched = data.find(row => (row["Player"] || "").trim().toLowerCase() === name.toLowerCase());
  if (matched) {
    matched.__season = s;
    break;
  }
}


    if (matched) {
      matched.__season = season;
      return matched;
    }
    return undefined;
  })
);



  if (playersData.some(p => p === undefined)) {
    alert('ì„ ìˆ˜ ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }

  playerSeasonData = {};
  playersData.forEach((p, idx) => {
    playerSeasonData[idx] = p;
  });

  comparePlayersFromCache();
};


function comparePlayersFromCache() {
  const players = Object.values(playerSeasonData);
  if (players.length < 1) return;

  playersData = players;

  let tableHTML = `<table><thead><tr><th>ì§€í‘œ</th>`;

  players.forEach((p, idx) => {
    const selectedSeason = p.__season || '24-25';
    tableHTML += `<th>
      <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
        <span style="font-weight: bold; color: #FFF;">
          ${p["Player"].split(' (')[0]}<br><span style="font-size: 0.75rem;">(${p["Player"].split(' (')[1]}</span>
        </span>
        <select id="seasonSwitch-${idx}" class="season-switch">
          <option value="20-21" ${selectedSeason === '20-21' ? 'selected' : ''}>20-21</option> <!-- âœ… ì¶”ê°€ -->
          <option value="21-22" ${selectedSeason === '21-22' ? 'selected' : ''}>21-22</option> <!-- âœ… ì¶”ê°€ -->
          <option value="22-23" ${selectedSeason === '22-23' ? 'selected' : ''}>22-23</option>
          <option value="23-24" ${selectedSeason === '23-24' ? 'selected' : ''}>23-24</option>
          <option value="24-25" ${selectedSeason === '24-25' ? 'selected' : ''}>24-25</option>
        </select>
      </div>
    </th>`;
  });

  if (players.length === 2) tableHTML += `<th>ì°¨ì´</th>`;
  tableHTML += `</tr></thead><tbody>`;

  statsLabels.forEach(stat => {
// ê°•ì œ ì¬ë§¤í•‘ëœ playerSeasonData ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡­ê²Œ pull í•´ì™€ì•¼ í•¨
const minGamesChecked = document.getElementById('compareMinGames').checked;

const values = players.map((p, idx) => {
  const season = p.__season;
  const seasonData = fullSeasonDataMap[season] || [];

  const filtered = seasonData.filter(row => {
    const isTypeMatched = activeTypes.has(row["êµ¬ë¶„"]);
    const isMinGames = !minGamesChecked || parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14;
    return isTypeMatched && isMinGames;
  });

  const matched = filtered.find(row => row["Player"].trim().toLowerCase() === p["Player"].trim().toLowerCase());

  // matched ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ undefined ë°˜í™˜
  if (matched) {
    matched.__season = season;
    playerSeasonData[idx] = matched;
    return parseFloat(matched[stat.key]);
  }

  return null; // â— ì¶œì „í•˜ì§€ ì•Šì€ ê²½ìš° null ë°˜í™˜
});


const ranks = values.map((val, idx) => {
  const season = players[idx].__season;
  const seasonData = fullSeasonDataMap[season] || [];

const filtered = seasonData.filter(row => {
  const isTypeMatched = activeTypes.has(row["êµ¬ë¶„"]);
  const isMinGames = !minGamesChecked || parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14;
  return isTypeMatched && isMinGames;
});

  return calculateRank(filtered, stat.key, val, stat.higherBetter);
});


    const sortedValues = [...values].sort((a, b) => stat.higherBetter ? b - a : a - b);
    const highlightClass = values.map(v => {
      if (v === sortedValues[0]) return 'highlight-first';
      if (v === sortedValues[1]) return 'highlight-second';
      return 'highlight-third';
    });

    tableHTML += `<tr data-category="${getCategoryByStat(stat.label)}"><td>${stat.label}</td>`;
    
values.forEach((value, idx) => {
  const displayValue = value === null ? 'N/A' : `${formatStatValue(stat.key, value)} (${ranks[idx]}ìœ„)`;
  tableHTML += `<td class="${highlightClass[idx]}">${displayValue}</td>`;
});
    
    if (players.length === 2) {
      const format = statsFormats[stat.key] || { unit: '', decimals: 2 };  // âœ… ì´ ì¤„ ì¶”ê°€ í•„ìˆ˜
    
      let v0 = values[0];
      let v1 = values[1];
      const isPercentUnit = format.unit === '%' && !['ORB%', 'DRB%', 'TRB%', 'AST%', 'STL%', 'BS%', 'TOV%'].includes(stat.key);
      if (isPercentUnit) {
        v0 *= 100;
        v1 *= 100;
      }
    
      const diff = v0 - v1;
      const diffClass = diff > 0 ? 'diff-positive' : diff < 0 ? 'diff-negative' : '';
    
      let formattedDiff;
      if (stat.key === "ì´ ì¶œì „ ì‹œê°„(ì´ˆ)" || format.unit === 'ë¶„ ì´ˆ') {
        const diffSeconds = Math.abs(diff);
        const minutes = Math.floor(diffSeconds / 60);
        const seconds = diffSeconds % 60;
        formattedDiff = `${minutes}ë¶„ ${seconds}ì´ˆ`;
      } else if (format.decimals === 0) {
        formattedDiff = `${Math.abs(diff)}${format.unit}`;
      } else {
        formattedDiff = `${Math.abs(diff).toFixed(format.decimals)}${format.unit}`;
      }
    
      tableHTML += `<td class="diff-cell ${diffClass}"><span>${formattedDiff}</span></td>`;
    }


    tableHTML += `</tr>`;
  });

  tableHTML += `</tbody></table>`;
  document.getElementById('compareResult').innerHTML = tableHTML;

  filterCompareTable();

  setTimeout(() => {
    players.forEach((_, idx) => {
      const selector = document.getElementById(`seasonSwitch-${idx}`);
      if (selector) {
        selector.onchange = (e) => {
          changeSeason(idx, e.target.value);
        };
      }
    });
  }, 0);
}
setTimeout(() => {
  const minGamesCheckbox = document.getElementById('compareMinGames');
  if (!minGamesCheckbox) return;

  minGamesCheckbox.onchange = () => {
    const names = playersData.map(p => p["Player"].trim());
    if (names.length === 0) {
      alert('ì„ ìˆ˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const updatedData = {};
    const newPlayers = [];

    names.forEach((name, idx) => {
      const selector = document.getElementById(`seasonSwitch-${idx}`);
      const season = selector ? selector.value : '23-24';
      const seasonData = fullSeasonDataMap[season] || [];

      const filtered = minGamesCheckbox.checked
        ? seasonData.filter(row => parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14)
        : seasonData;

      const matched = filtered.find(row => row["Player"].trim().toLowerCase() === name.toLowerCase());
      if (matched) {
        matched.__season = season;
        updatedData[idx] = matched;
        newPlayers.push(matched);
      }
    });

    if (newPlayers.length === 0) {
      alert('ê·œì • ê²½ê¸° ì´ìƒì„ ë§Œì¡±í•˜ëŠ” ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    playerSeasonData = updatedData;
    playersData = newPlayers;
    comparePlayersFromCache();
  };
}, 10);

  
  
// âœ… ì—¬ê¸°ë¶€í„° ìƒˆë¡œ ë¶™ì—¬ë„£ê¸°
window.changeSeason = function(playerIndex, season) {
  const fileMap = {
    '20-21': '20-21_KBL_stats.xlsx', // âœ… ì¶”ê°€
    '21-22': '21-22_KBL_stats.xlsx', // âœ… ì´ ì¤„ ì¶”ê°€
    '22-23': '22-23_KBL_stats.xlsx', // âœ… ì¶”ê°€
    '23-24': '23-24_KBL_stats.xlsx',
    '24-25': '24-25_KBL_stats.xlsx'
  };
  const url = `https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`;

  fetch(url)
    .then(response => response.arrayBuffer())
    .then(data => {
      const workbook = XLSX.read(data, { type: "array" });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const seasonData = XLSX.utils.sheet_to_json(sheet);

      // ì‹œê°„ ê³„ì‚°
      seasonData.forEach(cols => {
        const m = parseInt(cols["m"]) || 0;
        const s = parseInt(cols["s"]) || 0;
        cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = m * 60 + s;
      });

      // ì„ ìˆ˜ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
      const input = document.getElementById(`comparePlayer${playerIndex + 1}`);
      if (!input) return;

      const name = input.value.trim().toLowerCase();
      const matchedPlayer = seasonData.find(p => p["Player"]?.trim().toLowerCase() === name);

      if (!matchedPlayer) {
        // alert("ì„ ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); â† ì´ ì¤„ ì‚­ì œ
        playerSeasonData[playerIndex] = { Player: name, Team: '', __season: season };
        comparePlayersFromCache();  // ê³„ì† ë Œë”ë§
        return;
      }

      matchedPlayer.__season = season;
      fullSeasonDataMap[season] = seasonData;  // âœ… ì‹œì¦Œë³„ ë°ì´í„° ìºì‹œì— ì €ì¥ë§Œ
      playerSeasonData[playerIndex] = matchedPlayer;

      comparePlayersFromCache();
      
    })
    .catch(err => {
      console.error("ì‹œì¦Œ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:", err);
      alert("ì‹œì¦Œ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
    });
};
  
  }
// ì—”í„°í‚¤ ì…ë ¥ ê¸°ëŠ¥ ì¶”ê°€ (ìœ ì§€)
['comparePlayer1', 'comparePlayer2', 'comparePlayer3'].forEach(id => {
  document.getElementById(id).addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      comparePlayers();  // Enter í‚¤ì¼ ë•Œë§Œ ì‹¤í–‰
    }
  });
});

// ì²´í¬ë°•ìŠ¤ ì¦‰ì‹œ ë°˜ì‘ ì¶”ê°€ (ìœ ì§€)
// ì²´í¬ë°•ìŠ¤ ì¦‰ì‹œ ë°˜ì‘ ì¶”ê°€ (ìœ ì§€)
// comparePlayersFromCache ë§¨ ë§ˆì§€ë§‰ì— ì¶”ê°€í•˜ì„¸ìš” (ì´ë²¤íŠ¸ ë®ì–´ì“°ê¸°)
setTimeout(() => {
  document.getElementById('compareMinGames').onchange = () => {
    const p1 = document.getElementById('comparePlayer1').value.trim();
    const p2 = document.getElementById('comparePlayer2').value.trim();
    const p3 = document.getElementById('comparePlayer3').value.trim();
    const names = [p1, p2, p3].filter(n => n !== '');

    if (names.length === 0) {
      alert('ì„ ìˆ˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const updatedData = {};
    const newPlayers = [];

    names.forEach((name, idx) => {
      const selector = document.getElementById(`seasonSwitch-${idx}`);
      const season = selector ? selector.value : '23-24';
      const seasonData = fullSeasonDataMap[season] || [];

      const filtered = document.getElementById('compareMinGames').checked
        ? seasonData.filter(row => parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14)
        : seasonData;

      const matched = filtered.find(row => row["Player"].trim().toLowerCase() === name.toLowerCase());

      if (matched) {
        matched.__season = season;
        updatedData[idx] = matched;
        newPlayers.push(matched);
      }
    });

    if (newPlayers.length === 0) {
      alert('ê·œì • ê²½ê¸° ì´ìƒì„ ë§Œì¡±í•˜ëŠ” ì„ ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    playerSeasonData = updatedData;
    playersData = newPlayers;
    comparePlayersFromCache();
  };
}, 0);

// ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]').forEach(checkbox => {
  checkbox.addEventListener('change', filterCompareTable);
});

// ì²´í¬ë°•ìŠ¤ í•„í„°ë§ í•¨ìˆ˜ ì •ì˜
function filterCompareTable() {
  const checkedCategories = Array.from(document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]:checked'))
                                 .map(cb => cb.value);

  document.querySelectorAll('#compareResult tbody tr').forEach(row => {
    const category = row.getAttribute('data-category');
    row.style.display = checkedCategories.includes(category) ? '' : 'none';
  });
}

// ì§€í‘œ â†’ ì¹´í…Œê³ ë¦¬ ë³€í™˜ í•¨ìˆ˜ ì¶”ê°€ (ë§¨ ëì— ì¶”ê°€)
function getCategoryByStat(statLabel) {
  const categoryMap = {
    'ì¶œì „ ê²½ê¸° ìˆ˜': 'ê¸°ë³¸ ì •ë³´',
    'í‰ê·  ì¶œì „ ì‹œê°„': 'ê¸°ë³¸ ì •ë³´',
    'ë“ì ': 'ê¸°ë³¸ ì •ë³´',
    'í‰ê·  ë“ì ': 'ê¸°ë³¸ ì •ë³´',

    'í‰ê·  FG ì‹œë„': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  FG ì„±ê³µ': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  2p ì‹œë„': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  2p ì„±ê³µ': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  3p ì„±ê³µ': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  3p ì„±ê³µ': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  FT ì‹œë„': 'ìŠˆíŒ… ì§€í‘œ',
    'í‰ê·  FT ì„±ê³µ': 'ìŠˆíŒ… ì§€í‘œ',

    'FG%': 'ìŠˆíŒ… ì„±ê³µë¥ ',
    '2P%': 'ìŠˆíŒ… ì„±ê³µë¥ ',
    '3P%': 'ìŠˆíŒ… ì„±ê³µë¥ ',
    'FT%': 'ìŠˆíŒ… ì„±ê³µë¥ ',

    'ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',
    'í‰ê·  ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',
    'ê³µê²© ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',
    'í‰ê·  ê³µê²© ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',
    'ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',
    'í‰ê·  ìˆ˜ë¹„ ë¦¬ë°”ìš´ë“œ': 'ë¦¬ë°”ìš´ë“œ ì§€í‘œ',

    'ì–´ì‹œìŠ¤íŠ¸': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',
    'í‰ê·  ì–´ì‹œìŠ¤íŠ¸': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',
    'ìŠ¤í‹¸': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',
    'í‰ê·  ìŠ¤í‹¸': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',
    'ë¸”ë¡': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',
    'í‰ê·  ë¸”ë¡': 'ì–´ì‹œìŠ¤íŠ¸/ìŠ¤í‹¸/ë¸”ë¡ ì§€í‘œ',

    'í„´ì˜¤ë²„': 'ê¸°íƒ€ ì§€í‘œ',
    'í‰ê·  í„´ì˜¤ë²„': 'ê¸°íƒ€ ì§€í‘œ',
    'íŒŒìš¸': 'ê¸°íƒ€ ì§€í‘œ',
    'í‰ê·  íŒŒìš¸': 'ê¸°íƒ€ ì§€í‘œ',

    'WS': 'WinShare ì§€í‘œ',
    'WS/40': 'WinShare ì§€í‘œ',
    'Offensive_WS': 'WinShare ì§€í‘œ',
    'Defensive_WS': 'WinShare ì§€í‘œ',

    'PER': 'íš¨ìœ¨ì„± ì§€í‘œ',
    'EFF': 'íš¨ìœ¨ì„± ì§€í‘œ',
    'EFF/40': 'íš¨ìœ¨ì„± ì§€í‘œ',
    'Offensive_rating': 'íš¨ìœ¨ì„± ì§€í‘œ',
    'Defensive_rating': 'íš¨ìœ¨ì„± ì§€í‘œ',
    'USG%': 'íš¨ìœ¨ì„± ì§€í‘œ',

    'TS%': '2ì°¨ ìŠˆíŒ… ì§€í‘œ',
    'eFG%': '2ì°¨ ìŠˆíŒ… ì§€í‘œ',
    '3PAr': '2ì°¨ ìŠˆíŒ… ì§€í‘œ',
    'FTr': '2ì°¨ ìŠˆíŒ… ì§€í‘œ',

    'ORB%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'DRB%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'TRB%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'AST%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'STL%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'BS%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ',
    'TOV%': 'Teamë‚´ ë¹„ì¤‘ ì§€í‘œ'
  };
  return categoryMap[statLabel] || 'ê¸°íƒ€ ì§€í‘œ';
}

// ìµœì´ˆ ì‹¤í–‰ ì‹œ ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì„ íƒ ìƒíƒœë¡œ ì‹œì‘
window.addEventListener('DOMContentLoaded', () => {
  filterCompareTable();
});

async function loadLocalFile() {
  const fileInput = document.getElementById('fileUploader');

  if (fileInput.files.length === 0) {
    alert('ì—‘ì…€ íŒŒì¼ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    return;
  }

  const file = fileInput.files[0];
  const reader = new FileReader();

  reader.onload = function(e) {
    const data = new Uint8Array(e.target.result);
    const workbook = XLSX.read(data, {type: 'array'});

    const firstSheet = workbook.SheetNames[0];
    originalData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet]);

    originalData.forEach(cols => {
      let minutes = parseInt(cols["m"]) || 0;
      let seconds = parseInt(cols["s"]) || 0;
      cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = minutes * 60 + seconds;
    });

    renderTable(originalData);
    alert("ì—‘ì…€ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!");
  };

  reader.onerror = function(e) {
    console.error("íŒŒì¼ ë¡œë”© ì˜¤ë¥˜", e);
    alert("íŒŒì¼ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  };

  reader.readAsArrayBuffer(file);
}

  
 </script>
<script>
const sortDirections = {};

document.querySelectorAll('#statsTable thead th').forEach((header, index) => {
  sortDirections[index] = 'asc';
  header.onclick = () => {
    const tableBody = document.getElementById('tableBody');

    // âœ… ê¸°ì¡´ spacerRow ì‚­ì œ
    const oldSpacer = document.getElementById('spacerRow');
    if (oldSpacer) oldSpacer.remove();

    // âœ… ì‹¤ì œ ë°ì´í„° í–‰ë§Œ í•„í„°ë§
    const rows = Array.from(tableBody.querySelectorAll('tr'))
      .filter(row => row.id !== 'spacerRow' && row.querySelectorAll('td').length > 0);

    const direction = sortDirections[index] === 'asc' ? 'desc' : 'asc';
    sortDirections[index] = direction;

    rows.sort((a, b) => {
      let x = a.cells[index]?.getAttribute('data-time') || a.cells[index]?.innerText || '';
      let y = b.cells[index]?.getAttribute('data-time') || b.cells[index]?.innerText || '';

      x = x.replace(/</g, '').replace(/>/g, '');
      y = y.replace(/</g, '').replace(/>/g, '');

      x = parseFloat(x.replace(/[^\d.-]/g, '')) || 0;
      y = parseFloat(y.replace(/[^\d.-]/g, '')) || 0;

      return direction === 'asc' ? x - y : y - x;
    });

    // âœ… ì •ë ¬ëœ í–‰ ë‹¤ì‹œ ì¶”ê°€
    rows.forEach(row => tableBody.appendChild(row));

    // âœ… spacerRow ë‹¤ì‹œ ë§¨ ì•„ë˜ì— ì¶”ê°€
    const spacerRow = document.createElement('tr');
    spacerRow.id = 'spacerRow';
    spacerRow.innerHTML = '<td colspan="100" style="height: 100px; background: transparent; border: none;"></td>';
    tableBody.appendChild(spacerRow);

    window.renderTable = renderTable;

  };
});

function loadPlayersData2() {
  const season = document.getElementById('seasonSelectorPlayer')?.value || '23-24';
  const fileMap = {
    '20-21': '20-21_KBL_stats.xlsx',
    '21-22': '21-22_KBL_stats.xlsx',
    '22-23': '22-23_KBL_stats.xlsx',
    '23-24': '23-24_KBL_stats.xlsx',
    '24-25': '24-25_KBL_stats.xlsx'
  };
  const url = `https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`;

  fetch(url)
    .then(response => response.arrayBuffer())
    .then(data => {
      const workbook = XLSX.read(data, { type: "array" });
      const firstSheet = workbook.SheetNames[0];
      const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet]);

      jsonData.forEach(cols => {
        const minutes = parseInt(cols["m"]) || 0;
        const seconds = parseInt(cols["s"]) || 0;
        cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = minutes * 60 + seconds;

        const rawPlayer = (cols["Player"] || "").trim();
        const team = (cols["Team"] || "").trim();
        let name = rawPlayer;

        const match = name.match(/^(.*)\s\(([^)]+)\)(?:\s\(\2\))?$/);
        if (match) {
          name = `${match[1].trim()} (${match[2].trim()})`;
        } else if (!name.includes('(')) {
          name = `${name} (${team})`;
        }

        cols["Player"] = name;
        cols["Team"] = team;
        cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
      });

      // âœ… ìˆœì„œ ì¤‘ìš”: ë°ì´í„° ì„¸íŒ… ë¨¼ì €
      originalData = jsonData;
      fullSeasonDataMap[season] = jsonData;
      window.originalData = jsonData;

      // âœ… ìë™ì™„ì„± ëª©ë¡ ê°±ì‹ 
      const suggestionSet = new Set();
      originalData.forEach(cols => {
        const name = (cols["Player"] || "").trim();
        if (name) {
          suggestionSet.add(name);
        }
      });

      const datalist2 = document.getElementById("playerSuggestionsPlayer");
      if (datalist2) {
        datalist2.innerHTML = "";
        [...suggestionSet].sort().forEach(item => {
          const option = document.createElement("option");
          option.value = item;
          datalist2.appendChild(option);
        });
      }

      // âœ… ê²€ìƒ‰ì°½ ì…ë ¥ê°’ ê·¸ëŒ€ë¡œ ìœ ì§€ + ì¬ê²€ìƒ‰
      setTimeout(() => {
        const currentInput = document.getElementById('searchPlayer').value.trim();
        if (currentInput !== "") showPlayerStats();
      }, 100);
    })
    .catch(error => {
      console.error("ì„ ìˆ˜ ê°œì¸ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:", error);
      alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    });
}

async function loadAllSeasonsData() {
  const seasons = ['20-21', '21-22', '22-23', '23-24', '24-25'];
  const fileMap = {
    '20-21': '20-21_KBL_stats.xlsx',
    '21-22': '21-22_KBL_stats.xlsx',
    '22-23': '22-23_KBL_stats.xlsx',
    '23-24': '23-24_KBL_stats.xlsx',
    '24-25': '24-25_KBL_stats.xlsx'
  };

  for (const season of seasons) {
    if (fullSeasonDataMap[season]) continue;

    try {
      const res = await fetch(`https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`);
      const data = await res.arrayBuffer();
      const workbook = XLSX.read(data, { type: "array" });
      const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);

      jsonData.forEach(cols => {
        const m = parseInt(cols["m"]) || 0;
        const s = parseInt(cols["s"]) || 0;
        cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = m * 60 + s;

        const rawPlayer = (cols["Player"] || "").trim();
        const team = (cols["Team"] || "").trim();
        cols["Player"] = `${rawPlayer} (${team})`;
        cols["Team"] = team;
        cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
      });

      fullSeasonDataMap[season] = jsonData;
    } catch (err) {
      console.error(`âŒ ${season} ì‹œì¦Œ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨`, err);
    }
  }

  loadAllPlayerSuggestionsCompare();  // âœ… ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ ìƒì„±
}


document.addEventListener("DOMContentLoaded", async function () {
  await loadAllSeasonsData(); // âœ… ë¹„ë™ê¸° ì²˜ë¦¬ ì •ìƒ ì‘ë™
  loadPlayersData();      // âœ… 1í˜ì´ì§€ìš©
  loadPlayersData2();     // âœ… 2í˜ì´ì§€ìš©
  loadPlayerCompareSingleSuggestions(); // âœ… 4í˜ì´ì§€ ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ ìƒì„±
  
  // compareSeason1~3ì— ëŒ€í•œ updateCompareAutocompleteë„ ì—¬ê¸°
  ['1', '2', '3'].forEach(idx => {
    const selector = document.getElementById(`compareSeason${idx}`);
    if (selector) {
      selector.addEventListener('change', () => updateCompareAutocomplete(idx));
      updateCompareAutocomplete(idx);
    }
  });
  
  document.getElementById('seasonSelectorPlayer')?.addEventListener('change', () => {
    loadPlayersData2();
  });
 
  window.showPlayerStats = showPlayerStats;
  document.getElementById('searchPlayerButton').addEventListener('click', showPlayerStats);
  
  const searchBtn = document.getElementById('searchPlayerButton');
  if (searchBtn) {
    searchBtn.addEventListener('click', function () {
      showPlayerStats(); // âœ… í•¨ìˆ˜ê°€ ì •ì˜ëœ ë’¤ ì‹¤í–‰ë˜ë¯€ë¡œ ì˜¤ë¥˜ ì—†ìŒ
    });
  }

  document.getElementById('compareMinGamesSingle').addEventListener('change', () => {
    document.getElementById('compareSearchButton').click();
  });

  // âœ… ì´í•˜ ìƒëµ ì—†ì´ ë‚˜ë¨¸ì§€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€
  document.querySelectorAll('#comparePlayerFilterBox .filter-btn').forEach(btn => {
    const type = btn.dataset.type;
    btn.addEventListener('click', () => {
      if (activeTypes.has(type)) {
        activeTypes.delete(type);
        btn.classList.remove('active');
      } else {
        activeTypes.add(type);
        btn.classList.add('active');
      }

      localStorage.setItem('activeTypesComparePlayer', JSON.stringify([...activeTypes]));
      document.getElementById('compareSearchButton').click();
    });
  });

const savedTypesComparePlayer = localStorage.getItem('activeTypesComparePlayer');
if (savedTypesComparePlayer) {
  activeTypes = new Set(JSON.parse(savedTypesComparePlayer));
  document.querySelectorAll('#comparePlayerFilterBox .filter-btn').forEach(btn => {
    if (!activeTypes.has(btn.dataset.type)) {
      btn.classList.remove('active');
    }
  });
}

  (function () {
    const compareFilterBox = document.querySelectorAll('#compareFilterBox .filter-btn');
    const savedCompareTypes = localStorage.getItem('activeTypesCompare');
    if (savedCompareTypes) {
      activeTypes = new Set(JSON.parse(savedCompareTypes));
      compareFilterBox.forEach(btn => {
        if (!activeTypes.has(btn.dataset.type)) {
          btn.classList.remove('active');
        }
      });
    }

    compareFilterBox.forEach(btn => {
      const type = btn.dataset.type;
      btn.addEventListener('click', () => {
        if (activeTypes.has(type)) {
          activeTypes.delete(type);
          btn.classList.remove('active');
        } else {
          activeTypes.add(type);
          btn.classList.add('active');
        }
        localStorage.setItem('activeTypesCompare', JSON.stringify([...activeTypes]));
      });
    });
  })();

  const seasonSelectorPlayer = document.getElementById('seasonSelectorPlayer');
  if (seasonSelectorPlayer) {
    seasonSelectorPlayer.addEventListener('change', () => {
      loadPlayersData2();
    });
  }

  const checkboxes = document.querySelectorAll('#compareStatCheckboxes input[type="checkbox"]');
  checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
      const checked = document.querySelectorAll('#compareStatCheckboxes input[type="checkbox"]:checked');
      if (checked.length > 3) {
        cb.checked = false;
        alert("ìµœëŒ€ 3ê°œê¹Œì§€ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
      }
    });
  });

  document.querySelectorAll('.filter-toggle').forEach(btn => {
    const type = btn.dataset.type;
    const saved = localStorage.getItem('activeTypes');
    if (saved) {
      activeTypes = new Set(JSON.parse(saved));
      if (!activeTypes.has(type)) btn.classList.remove('selected');
    }

    btn.addEventListener('click', () => {
      if (activeTypes.has(type)) {
        activeTypes.delete(type);
        btn.classList.remove('selected');
      } else {
        activeTypes.add(type);
        btn.classList.add('selected');
      }

      localStorage.setItem('activeTypes', JSON.stringify([...activeTypes]));
      renderTable(originalData);
    });
  });
});


window.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('#playerFilterBox .filter-btn').forEach(btn => {
    const type = btn.dataset.type;

    btn.addEventListener('click', () => {
      if (activeTypes.has(type)) {
        activeTypes.delete(type);
        btn.classList.remove('active');
      } else {
        activeTypes.add(type);
        btn.classList.add('active');
      }

      localStorage.setItem('activeTypesPlayer', JSON.stringify([...activeTypes]));

      showPlayerStats(); // ğŸ”¥ ì´ê²Œ ì¦‰ì‹œ ì¹´ë“œ ê°±ì‹ ì‹œí‚¤ëŠ” í•µì‹¬
    });
  });
});
// âœ… 3í˜ì´ì§€ ë¹„êµ íƒ­: ì—”í„° í‚¤ ì…ë ¥ ì‹œ ìë™ ë¹„êµ ì‹¤í–‰
['comparePlayer1', 'comparePlayer2', 'comparePlayer3'].forEach(id => {
  const input = document.getElementById(id);
  if (input) {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        comparePlayers();
      }
    });
  }
});
document.getElementById('compareSearchButton').addEventListener('click', async () => {
  let playerName = document.getElementById('compareSearchPlayer').value.trim();
  
  // âœ… ì¤‘ë³µ ê´„í˜¸ ì œê±° (ì˜ˆ: "ê¸€ë Œ ë¡œë¹ˆìŠ¨ 3ì„¸ (ì„œìš¸ ì‚¼ì„±) (ì„œìš¸ ì‚¼ì„±)" â†’ "ê¸€ë Œ ë¡œë¹ˆìŠ¨ 3ì„¸ (ì„œìš¸ ì‚¼ì„±)")
  const matches = playerName.match(/\(([^)]+)\)/g);
  if (matches && matches.length > 1) {
    const namePart = playerName.split('(')[0].trim();
    const teamPart = matches[0].replace(/[()]/g, '').trim();
    playerName = `${namePart} (${teamPart})`;
  }
  playerName = playerName.toLowerCase();
  const selectedMetrics = Array.from(document.querySelectorAll('#compareStatCheckboxes input[type="checkbox"]:checked'))
                               .map(cb => cb.value);

  if (!playerName || selectedMetrics.length === 0) {
    alert('ì„ ìˆ˜ ì´ë¦„ê³¼ ì§€í‘œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  const resultContainer = document.getElementById('compareStatResults');
  resultContainer.innerHTML = ''; // ì´ˆê¸°í™”

  const seasons = ['20-21', '21-22', '22-23', '23-24', '24-25'];
  const fileMap = {
    '20-21': '20-21_KBL_stats.xlsx',
    '21-22': '21-22_KBL_stats.xlsx',
    '22-23': '22-23_KBL_stats.xlsx',
    '23-24': '23-24_KBL_stats.xlsx',
    '24-25': '24-25_KBL_stats.xlsx'
  };

  const playerStats = {};
  const seasonLabels = [];

  for (const season of seasons) {
    try {
      const res = await fetch(`https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`);
      const data = await res.arrayBuffer();
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(sheet);

      // ì´ë¦„/íŒ€ëª… ì •ì œ
      jsonData.forEach(cols => {
        cols["Player"] = (cols["Player"] || "").trim();
        cols["Team"] = (cols["Team"] || "").trim();
        cols["êµ¬ë¶„"] = (cols["êµ¬ë¶„"] || "").trim();
        const m = parseInt(cols["m"]) || 0;
        const s = parseInt(cols["s"]) || 0;
        cols["ì´ ì¶œì „ ì‹œê°„(ì´ˆ)"] = m * 60 + s;
      });

    const minGamesChecked = document.getElementById('compareMinGamesSingle')?.checked;
    
      const filtered = jsonData.filter(row =>
        activeTypes.has(row["êµ¬ë¶„"]) &&
        row["Player"].toLowerCase() === playerName.toLowerCase() &&
        (!minGamesChecked || parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14)
      );

      if (filtered.length > 0) {
        const preferred = filtered.find(row => row["Player"].includes(" to ")) || filtered[0];
        playerStats[season] = preferred;
        seasonLabels.push(season);
      }

    } catch (err) {
      console.error(`âŒ ${season} ë¡œë”© ì‹¤íŒ¨`, err);
    }
  }

    if (Object.keys(playerStats).length === 0) {
      alert("ì„ ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }
    
  selectedMetrics.forEach((metric, idx) => {
    const canvasId = `metricChart${idx}`;
    const statData = [];
    const rankData = [];
    // ì „ì²´ ì‹œì¦Œì—ì„œ ë­í‚¹ ê³„ì‚°ìš©
    const allSeasonStats = {};

    seasons.forEach(season => {
      if (playerStats[season]) {
        const val = parseFloat(playerStats[season][metric]) || 0;
        statData.push(val);
        allSeasonStats[season] = val;
      } else {
        statData.push(null);
        allSeasonStats[season] = null;
      }
    });
    
    const isPercentMetric = metric.includes('%');
    const validValues = statData.filter(v => v !== null && !isNaN(v));
    const minValue = Math.min(...validValues);
    const yMin = isPercentMetric ? Math.max(0, minValue - 0.05) : undefined;
    // ë¦¬ê·¸ ë‚´ ìˆœìœ„ ê³„ì‚°
   const minGamesChecked = document.getElementById('compareMinGamesSingle')?.checked;
    
    const rankPromises = seasons.map(async season => {
      if (!playerStats[season]) return '-';
      const res = await fetch(`https://raw.githubusercontent.com/dookie777/KBL-Player-Performance-Analyzer/main/${fileMap[season]}`);
      const data = await res.arrayBuffer();
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(sheet);

      const values = jsonData
        .filter(row => 
          activeTypes.has(row["êµ¬ë¶„"]) &&
          (!minGamesChecked || parseInt(row["ì¶œì „ ê²½ê¸° ìˆ˜"]) >= 14)
        )
        .map(row => parseFloat(row[metric]))
        .filter(v => !isNaN(v));

      const sorted = [...values].sort((a, b) => {
        const config = statsFormats[metric] || { higherBetter: true };
        return config.higherBetter === false ? a - b : b - a;
      });

      const playerValue = parseFloat(playerStats[season][metric]);
      const rank = sorted.indexOf(playerValue) + 1;
      return isNaN(rank) || rank === 0 ? '-' : rank;
    });

    Promise.all(rankPromises).then(ranks => {
      // ê²°ê³¼ ì¹´ë“œ êµ¬ì„±
      const card = document.createElement('div');
      card.className = 'stat-card';
      card.innerHTML = `
          <h3>${metric}</h3>
          <canvas id="${canvasId}" height="360"></canvas>
      `;
      document.getElementById('compareStatResults').appendChild(card);

      // Chart.js ë Œë”ë§
      new Chart(document.getElementById(canvasId), {
        type: 'line',
        data: {
          labels: seasons,
          datasets: [{
            label: metric,
            data: statData,
            borderColor: '#FFA500',
            backgroundColor: 'rgba(255,165,0,0.2)',
            tension: 0.3,
            pointRadius: 5,
            pointHoverRadius: 6,
            pointBackgroundColor: '#FFA500',
            pointBorderColor: '#fff',
            datalabels: {
              align: 'top',
              anchor: 'end'
            }
          }]
        },
        plugins: [ChartDataLabels],
options: {
  layout: {
    padding: {
      top: 45,
      bottom: 10,
      left: 25,    // âœ… ì™¼ìª½ ì—¬ë°± ì¶”ê°€
      right: 25    // âœ… ì˜¤ë¥¸ìª½ ì—¬ë°± ì¶”ê°€
    }
  },
  responsive: true,
  plugins: {
    legend: { display: false },
    datalabels: {
      color: '#fff',
      font: {
        weight: 'bold'
      },
    formatter: (value, ctx) => {
      const rank = ranks[ctx.dataIndex];
      const metric = ctx.chart.data.datasets[0].label;
      return `${formatStatValue(metric, value)}\n${rank}ìœ„`;
    }
    },
    tooltip: {
    callbacks: {
      label: (context) => {
        const value = context.parsed.y;
        const rank = ranks[context.dataIndex];
        const metric = context.dataset.label;
        return ` ${formatStatValue(metric, value)} / ${rank}ìœ„`;
      }
    }
    }
  },
scales: {
  y: {
    beginAtZero: false,
    min: yMin,
    ticks: {
      display: false
    },
    grid: {
      color: '#333',
      drawTicks: false,         // âœ… ì¶• ëì— íŠ€ì–´ë‚˜ì˜¨ ëˆˆê¸ˆ ì œê±°
      drawBorder: false,        // âœ… yì¶• ì™¼ìª½ ê²½ê³„ì„  ì œê±°
      borderColor: '#333',
      borderWidth: 0,
      clip: false               // âœ… ìº”ë²„ìŠ¤ ë°– ë Œë”ë§ ë°©ì§€
    }
  },
    x: {
      ticks: { color: '#fff' },
      grid: { color: '#333' }
    }
  }
}

      });
    });
  });
});
// âœ… 4í˜ì´ì§€ compareSearchButton ë²„íŠ¼ í´ë¦­ ì‹œ ê²€ìƒ‰ ì‹¤í–‰
document.getElementById('compareSearchButton').addEventListener('click', async () => {
  const event = new KeyboardEvent('keypress', { key: 'Enter' });
  document.getElementById('compareSearchPlayer').dispatchEvent(event);
});  
</script>

 
 </body>
 </html>
