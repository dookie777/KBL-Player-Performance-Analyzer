<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Basketball Stats Analyzer</title>
<style>
body {
  background: #121212; color: #FFF;
  font-family: Arial, sans-serif; margin:0; padding:0; overflow:hidden;
}
.container {
  display:flex; flex-direction:column; height:100vh; max-width:1200px; margin:auto; padding:20px;
}
h2, .input-box, .footer { text-align:center; }
h2 { color:#FFA500; }
.input-box { padding:10px 0; background:#1e1e1e; }
.scroll-container {
  flex:1; overflow:auto; margin:10px 0; padding-bottom:50px;
}
table {
  border-collapse:collapse; white-space:nowrap; min-width:1500px; 
}
th, td {
  padding:6px 8px; border-bottom:1px solid #333; font-size:0.85rem;
  background:#181818; color:#FFF; text-align:center;
}
th {
  background:#282828; position:sticky; top:0; cursor:pointer; z-index:10;
}
th:nth-child(-n+2), td:nth-child(-n+2) {
  position:sticky; left:0; background:#282828; z-index:20;
}
th:nth-child(2), td:nth-child(2) { left:150px; }
.valid {color:#55FF55;} .warning {color:#FF5555;}
.highlight {border-bottom:3px solid #FFA500 !important;}
.footer {
  padding:10px; border-top:1px solid #333; font-size:0.8rem; color:#888;
  position:fixed; bottom:0; left:0; width:100%; background:#000;
}
.footer img { width:100px; height:auto; margin-bottom:5px; }
.scroll-container::-webkit-scrollbar { height:8px; width:8px; }
.scroll-container::-webkit-scrollbar-track { background:#282828; }
.scroll-container::-webkit-scrollbar-thumb { background:#FFA500; border-radius:10px; }
</style>
</head>
<body>
<div class="container">
  <h2>Basketball Stats Analyzer</h2>
  <div class="input-box">
    <input type="text" id="playerSearch" placeholder="Search player..." />
    <button onclick="searchPlayer()">Search</button>
  </div>
  <div class="scroll-container">
    <table id="statsTable">
      <thead>
        <tr>
          <th>선수 이름</th><th>팀</th><th>경기수(G)</th><th>출전시간</th>
          <th>PTS(총득점)</th><th>PTS_avg</th><th>FG</th><th>FGA</th><th>FG%</th>
          <th>2P</th><th>2PA</th><th>2P%</th><th>3P</th><th>3PA</th><th>3P%</th>
          <th>FT</th><th>FTA</th><th>FT%</th><th>ORB</th><th>DRB</th><th>TRB</th>
          <th>TRB_avg</th><th>AST</th><th>AST_avg</th><th>STL</th><th>STL_avg</th>
          <th>BLK</th><th>BLK_avg</th><th>TO</th><th>PF</th><th>WS</th><th>OWS</th>
          <th>DWS</th><th>PER</th><th>TS%</th><th>eFG%</th><th>USG%</th>
          <th>Off Rating</th><th>Def Rating</th><th>Eff/Game</th><th>Eff/40min</th>
          <th>ORB%</th><th>DRB%</th><th>AST%</th><th>STL%</th><th>BLK%</th><th>TOV%</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
  <footer class="footer">
    <img src="https://github.com/dookie777/vibe-index/blob/main/Logo_white.png?raw=true" alt="Eroom Sports Logo">
    <div>© 2025 The Eroom Sports. All rights reserved.</div>
  </footer>
</div>

<script>
let originalData=[],highlightedPlayer='';
async function loadPlayersData(){
  const res=await fetch('https://docs.google.com/spreadsheets/d/1ez03AkQt4A5HWmo3jRAV3DOyfKfCU4xiI7XCjLRjwnE/export?format=csv');
  const data=await res.text();
  originalData=data.split('\n').slice(1).map(r=>r.split(',')).filter(c=>c.length>30).map(c=>{
    c[49]=+c[4]*60+(+c[5]);return c;
  });
  renderTable(originalData);
}
function renderTable(data){
  const t=document.getElementById('tableBody');t.innerHTML='';
  data.forEach(c=>{
    const s=c[3]>=20?'✅':'⚠️',p=`${c[4]}분 ${c[5]}초`,n=c[2];
    const r=document.createElement('tr');
    if(n===highlightedPlayer)r.classList.add('highlight');
    r.innerHTML=`<td>${n} <span class="${c[3]>=20?'valid':'warning'}">${s}</span></td>`+
      `<td>${c[1]}</td><td>${c[3]}</td><td data-time="${c[49]}">${p}</td>`+
      c.slice(6,49).map((v,i)=>`<td>${(i==1||i==17||i==19||i==21||i==23||i==25||i==27)?(+v).toFixed(2):v}</td>`).join('');
    t.appendChild(r);
  });
}
function searchPlayer(){
  const q=document.getElementById('playerSearch').value.toLowerCase(),t=document.getElementById('tableBody');
  const rows=Array.from(t.querySelectorAll('tr'));let f=false;
  rows.forEach(r=>{
    r.classList.remove('highlight');
    const n=r.children[0].textContent.toLowerCase();
    if(n.includes(q)){highlightedPlayer=r.children[0].textContent.split(' ')[0];r.classList.add('highlight');t.prepend(r);f=true;}
  });
  if(!f)alert('Player not found');
}
const sortDirections={};
document.querySelectorAll('th').forEach((h,i)=>h.onclick=()=>sortTable(i));
function sortTable(i){
  const t=document.getElementById('tableBody'),rows=Array.from(t.querySelectorAll('tr')),
  d=sortDirections[i]==='asc'?'desc':'asc';sortDirections[i]=d;
  rows.sort((a,b)=>{
    const ac=i==3?+a.children[i].dataset.time:parseFloat(a.children[i].textContent)||0,
    bc=i==3?+b.children[i].dataset.time:parseFloat(b.children[i].textContent)||0;
    return d==='asc'?ac-bc:bc-ac;
  });
  rows.forEach(r=>t.appendChild(r));
}
window.onload=loadPlayersData;
</script>
</body>
</html>
