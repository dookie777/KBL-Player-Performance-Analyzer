<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basketball Stats Analyzer</title>
<style>
/* 여기서부터 시작 */
body {
  background-color: #121212;
  color: #FFFFFF;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  overflow: hidden;
}
.container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-width: 1200px;
  margin: auto;
  padding: 20px;
  box-sizing: border-box;
}
h2, .input-box, .footer {
  text-align: center;
}
h2 {
  color: #FFA500;
}
.input-box {
  padding: 10px 0;
  background-color: #1e1e1e;
}
.scroll-container {
  flex: 1;
  overflow: auto;
  margin: 10px 0;
  max-width: 100%;
}

table {
  border-collapse: collapse;
  table-layout: auto;
  white-space: nowrap;
  width: auto;
  min-width: 100%;
}

th, td {
  padding: 6px 8px;
  text-align: center;
  border-bottom: 1px solid #333;
  font-size: 0.85rem;
}

th {
  background-color: #282828;
  position: sticky;
  top: 0;
  cursor: pointer;
  z-index: 10;
}

td {
  background-color: #181818;
}

th:nth-child(1), td:nth-child(1),
th:nth-child(2), td:nth-child(2) {
  position: sticky;
  left: 0;
  background-color: #282828;
  z-index: 20;
}

th:nth-child(2), td:nth-child(2) {
  left: 150px;
}

.warning { color: #FF5555; }
.valid { color: #55FF55; }
.footer {
  padding: 10px 0;
  border-top: 1px solid #333;
  font-size: 0.8rem;
  color: #888;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #000000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}
.footer img {
  width: 100px;
  height: auto;
  margin-bottom: 5px;
}
.scroll-container::-webkit-scrollbar {
  height: 8px;
}
.scroll-container::-webkit-scrollbar-track {
  background: #282828;
}
.scroll-container::-webkit-scrollbar-thumb {
  background-color: #FFA500;
  border-radius: 10px;
}

</style>

</style>
</head>
<body>
<div class="container">
  <h2>Basketball Stats Analyzer</h2>
  <div class="input-box">
    <input type="text" id="playerSearch" placeholder="Search player..." />
    <button onclick="searchPlayer()">Search</button>
  </div>
<div class="scroll-container">
  <table id="statsTable">
    <thead>
      <tr>
        <th>선수 이름</th>
        <th>팀</th>
        <th>경기수(G)</th>
        <th>출전시간</th>
        <th>PTS(총득점)</th>
        <th>PTS_avg</th>
        <th>FG</th>
        <th>FGA</th>
        <th>FG%</th>
        <th>2P</th>
        <th>2PA</th>
        <th>2P%</th>
        <th>3P</th>
        <th>3PA</th>
        <th>3P%</th>
        <th>FT</th>
        <th>FTA</th>
        <th>FT%</th>
        <th>ORB</th>
        <th>DRB</th>
        <th>TRB</th>
        <th>TRB_avg</th>
        <th>AST</th>
        <th>AST_avg</th>
        <th>STL</th>
        <th>STL_avg</th>
        <th>BLK</th>
        <th>BLK_avg</th>
        <th>TO</th>
        <th>PF</th>
        <th>WS</th>
        <th>OWS</th>
        <th>DWS</th>
        <th>PER</th>
        <th>TS%</th>
        <th>eFG%</th>
        <th>USG%</th>
        <th>Offensive Rating</th>
        <th>Defensive Rating</th>
        <th>Efficiency/Game</th>
        <th>Efficiency/40min</th>
        <th>ORB%</th>
        <th>DRB%</th>
        <th>AST%</th>
        <th>STL%</th>
        <th>BLK%</th>
        <th>TOV%</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

  <footer class="footer">
    <img src="https://github.com/dookie777/vibe-index/blob/main/Logo_white.png?raw=true" alt="The Eroom Sports Logo">
    <div>© 2025 The Eroom Sports. All rights reserved.</div>
  </footer>
</div>

<script>
let originalData = [];
let highlightedPlayer = '';  // 검색된 선수 이름 기억

async function loadPlayersData() {
  const res = await fetch('https://docs.google.com/spreadsheets/d/1ez03AkQt4A5HWmo3jRAV3DOyfKfCU4xiI7XCjLRjwnE/export?format=csv');
  const data = await res.text();
  const rows = data.split('\n').slice(1);

  originalData = rows.map(row => row.split(',')).filter(cols => cols.length > 30);
  
  // 초로 환산한 시간 추가
  originalData.forEach(cols => {
    cols.push(parseInt(cols[4]) * 60 + parseInt(cols[5])); // [49]번 인덱스에 초로 환산한 시간 저장
  });

  renderTable(originalData);
}

function renderTable(data) {
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  data.forEach(cols => {
    const status = cols[3] >= 20 ? '✅' : '⚠️';
    const playtime = `${cols[4]}분 ${cols[5]}초`;
    const playerName = cols[2];

    tableBody.innerHTML += `<tr ${playerName === highlightedPlayer ? 'style="border-bottom: 3px solid #FFA500;"' : ''}>
      <td>${playerName} <span class="${cols[3] >= 20 ? 'valid' : 'warning'}">${status}</span></td>
      <td>${cols[1]}</td>
      <td>${cols[3]}</td><td data-time="${cols[49]}">${playtime}</td><td>${cols[6]}</td>
      <td>${(+cols[7]).toFixed(2)}</td><td>${cols[8]}</td><td>${cols[9]}</td><td>${cols[10]}</td>
      <td>${cols[11]}</td><td>${cols[12]}</td><td>${cols[13]}</td><td>${cols[14]}</td><td>${cols[15]}</td>
      <td>${cols[16]}</td><td>${cols[17]}</td><td>${cols[18]}</td><td>${cols[19]}</td><td>${cols[20]}</td>
      <td>${cols[21]}</td><td>${cols[22]}</td><td>${(+cols[23]).toFixed(2)}</td><td>${cols[24]}</td>
      <td>${(+cols[25]).toFixed(2)}</td><td>${cols[26]}</td><td>${(+cols[27]).toFixed(2)}</td><td>${cols[28]}</td>
      <td>${(+cols[29]).toFixed(2)}</td><td>${cols[30]}</td><td>${cols[31]}</td><td>${cols[32]}</td><td>${cols[33]}</td>
      <td>${cols[34]}</td><td>${cols[35]}</td><td>${cols[36]}</td><td>${cols[37]}</td><td>${cols[38]}</td>
      <td>${cols[39]}</td><td>${cols[40]}</td><td>${cols[41]}</td><td>${cols[42]}</td><td>${cols[43]}</td>
      <td>${cols[44]}</td><td>${cols[45]}</td><td>${cols[46]}</td><td>${cols[47]}</td><td>${cols[48]}</td>
    </tr>`;
  });
}

function searchPlayer() {
  const query = document.getElementById('playerSearch').value.toLowerCase();
  const tableBody = document.getElementById('tableBody');
  const rows = Array.from(tableBody.querySelectorAll('tr'));
  let found = false;

  rows.forEach(row => {
    const playerName = row.children[0].textContent.toLowerCase();
    row.style.borderBottom = "1px solid #333";
    if (playerName.includes(query)) {
      found = true;
      highlightedPlayer = row.children[0].textContent.split(' ')[0];  // 강조된 선수 이름 기억
      tableBody.prepend(row);
      row.style.borderBottom = "3px solid #FFA500";
    }
  });

  if (!found) alert('Player not found');
}

const sortDirections = {};
document.querySelectorAll('th').forEach((header, index) => {
  header.innerHTML += ' <span class="sort-arrow">↕</span>';
  header.addEventListener('click', () => sortTable(index));
});

function sortTable(columnIndex) {
  const tableBody = document.getElementById('tableBody');
  const rowsArray = Array.from(tableBody.querySelectorAll('tr'));
  const direction = sortDirections[columnIndex] === 'asc' ? 'desc' : 'asc';
  sortDirections[columnIndex] = direction;

  rowsArray.sort((a, b) => {
    let aCell, bCell;
    if(columnIndex === 3){ //출전시간 열인 경우 초로 환산하여 정렬
      aCell = +a.children[columnIndex].getAttribute('data-time');
      bCell = +b.children[columnIndex].getAttribute('data-time');
    }else{
      aCell = parseFloat(a.children[columnIndex].textContent.replace(/[^\d.-]/g, '')) || a.children[columnIndex].textContent;
      bCell = parseFloat(b.children[columnIndex].textContent.replace(/[^\d.-]/g, '')) || b.children[columnIndex].textContent;
    }

    if (!isNaN(aCell) && !isNaN(bCell)) {
      return direction === 'asc' ? aCell - bCell : bCell - aCell;
    }
    return direction === 'asc' ? aCell.localeCompare(bCell) : bCell.localeCompare(aCell);
  });

  tableBody.innerHTML = '';
  rowsArray.forEach(row => {
    if (row.children[0].textContent.includes(highlightedPlayer)) {
      row.style.borderBottom = "3px solid #FFA500"; //정렬 후에도 유지
    } else {
      row.style.borderBottom = "1px solid #333";
    }
    tableBody.appendChild(row);
  });
}

window.onload = loadPlayersData;

</script>
</body>
</html>
