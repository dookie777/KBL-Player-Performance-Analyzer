<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KBL Player Stats Analyzer</title>
  <style>
    body {
      background: #121212;
      color: #FFF;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .container {
      max-width: 1200px;
      margin: auto;
      padding: 20px;
      box-sizing: border-box;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    h2 {
      text-align: center;
      color: #FFA500;
    }

    .tabs {
      text-align: center;
      margin-bottom: 15px;
    }

    .tabs button {
      background: #282828;
      color: #FFF;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      margin: 0 5px;
      font-weight: bold;
      width: 160px;
    }

    .tabs button.active {
      background: #E0E0E0;
      color: #000;
    }

    .tab-content {
      display: none;
      flex: 1;
      overflow: auto;
    }

    .tab-content.active {
      display: block;
    }

    table {
      border-collapse: collapse;
      white-space: nowrap;
      width: 100%;
    }

    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #333;
      font-size: 0.85rem;
      text-align: center;
      background: #181818;
    }

    thead th {
      background: #282828;
      position: sticky;
      top: 0;
      cursor: pointer;
      z-index: 200;
    }

    #tab-all th:nth-child(1), #tab-all td:nth-child(1),
    #tab-all th:nth-child(2), #tab-all td:nth-child(2) {
      position: sticky;
      left: 0;
      background-color: #282828;
      z-index: 300;
    }

    #tab-all th:nth-child(2), #tab-all td:nth-child(2) {
      left: 150px;
    }

    .highlight { color: #FFFF55 !important; font-weight: bold; }

    .footer {
      text-align: center;
      padding: 10px;
      font-size: 0.8rem;
      color: #888;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #000;
      pointer-events: none;
    }

    .input-box {
      text-align: center;
      margin-bottom: 20px;
    }

    .input-box input[type="text"] {
      width: 250px;
      height: 42px;
      padding: 5px 10px;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
      box-sizing: border-box;
      margin-right: 5px;
    }

    .input-box button {
      height: 42px;
      padding: 5px 15px;
      font-size: 0.9rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      background-color: #88c2dd;
      color: #121212;
      border: none;
    }

    .player-name, .team-name {
      text-align: center;
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .card {
      background-color: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-sizing: border-box;
    }

    .card h3 { color: #FFA500; }
    .card.secondary h3 { color: #88c2dd; }

    .card table { width: 100%; }

    .stats-container::-webkit-scrollbar {
      width: 8px;
    }

    .stats-container::-webkit-scrollbar-track {
      background: #282828;
    }

    .stats-container::-webkit-scrollbar-thumb {
      background: #CED4DA;
      border-radius: 10px;
    }
/* 1,2열(선수이름, 팀) 고정하기 위한 CSS */
#tab-all th:nth-child(1), #tab-all td:nth-child(1),
#tab-all th:nth-child(2), #tab-all td:nth-child(2) {
  position: sticky;
  left: 0;
  background-color: #282828;
  z-index: 300;
}

#tab-all th:nth-child(2), #tab-all td:nth-child(2) {
  left: 150px;
}
    /* 선수 개인검색(2페이지) 결과 카드 정상 디자인 코드 */

.player-name {
  font-size: 2rem;
  font-weight: bold;
  margin: 15px 0 5px 0;
  text-align: center;
  color: #FFF;
}

.team-name {
  font-size: 1rem;
  text-align: center;
  color: #FFF;
  margin-bottom: 15px;
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 20px;
  overflow-y: auto;
  height: calc(100vh - 250px);
  padding-right: 10px;
}

.card {
  background-color: rgba(255,255,255,0.05);
  padding: 10px;
  border-radius: 10px;
  text-align: center;
  box-sizing: border-box;
  min-height: 350px;
}

.card.primary:nth-child(2) {
  min-height: 420px;
}

.card.primary h3 { color: #FFA500; }
.card.secondary h3 { color: #88c2dd; }

.card h3 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 1.1rem;
}

.card table {
  width: 100%;
  border-collapse: collapse;
}

.card th, .card td {
  padding: 8px 5px;
  border-bottom: 1px solid rgba(255,255,255,0.2);
  font-size: 0.9rem;
}

.highlight {
  color: #FFFF55 !important;
  font-weight: bold;
}

.stats-container::-webkit-scrollbar {
  width: 8px;
}

.stats-container::-webkit-scrollbar-track {
  background: #282828;
}

.stats-container::-webkit-scrollbar-thumb {
  background: #CED4DA;
  border-radius: 10px;
}

  </style>
</head>
<body>
<div class="container">
  <h2>KBL Player Stats Analyzer</h2>
  <div class="tabs">
    <button class="tab-button active" data-tab="tab-all">전체 선수 통계</button>
    <button class="tab-button" data-tab="tab-player">선수 개인 검색</button>
  </div>

  <div id="tab-all" class="tab-content active">
    <div class="input-box">
      <input type="text" id="searchPlayerAll" placeholder="Search player...">
      <button onclick="searchPlayer()">Search</button>
      <input type="checkbox" id="minGamesCheckbox">
      <label for="minGamesCheckbox">규정 경기 이상만 표시(14G)</label>
    </div>
    <div class="scroll-container">
      <table id="statsTable">
        <thead>
            <tr>
    <th>선수 이름</th><th>팀</th><th>경기수(G)</th><th>출전시간</th>
    <th>PTS(총득점)</th><th>PTS_avg</th><th>FG</th><th>FGA</th><th>FG%</th>
    <th>2P</th><th>2PA</th><th>2P%</th><th>3P</th><th>3PA</th><th>3P%</th>
    <th>FT</th><th>FTA</th><th>FT%</th><th>ORB</th><th>DRB</th><th>TRB</th>
    <th>TRB_avg</th><th>AST</th><th>AST_avg</th><th>STL</th><th>STL_avg</th>
    <th>BLK</th><th>BLK_avg</th><th>TO</th><th>PF</th><th>WS</th><th>OWS</th>
    <th>DWS</th><th>PER</th><th>TS%</th><th>eFG%</th><th>USG%</th>
    <th>Off Rating</th><th>Def Rating</th><th>Eff/Game</th><th>Eff/40min</th>
    <th>ORB%</th><th>DRB%</th><th>AST%</th><th>STL%</th><th>BLK%</th><th>TOV%</th>
  </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <div id="tab-player" class="tab-content">
    <div class="input-box">
      <input type="text" id="searchPlayer" placeholder="Search player...">
      <button onclick="showPlayerStats()">Search</button>
      <input type="checkbox" id="minGames">
      <label for="minGames">규정 경기 이상(14G)</label>
    </div>
    <div class="player-name" id="playerName"></div>
    <div class="team-name" id="teamName"></div>
    <div class="stats-container" id="statsContainer"></div>
  </div>

  <footer class="footer">
    © 2025 The Eroom Sports. All rights reserved.
  </footer>
</div>

<script>
 const tabs = document.querySelectorAll('.tab-button');
 const contents = document.querySelectorAll('.tab-content');
 
 tabs.forEach(tab => {
   tab.onclick = () => {
     tabs.forEach(t => t.classList.remove('active'));
     contents.forEach(c => c.classList.remove('active'));
     document.getElementById(tab.dataset.tab).classList.add('active');
     tab.classList.add('active');
   };
 });
 
 let originalData = [], highlightedPlayer = '', fixedRow = null;
 
 async function loadPlayersData() {
   const res = await fetch('https://docs.google.com/spreadsheets/d/1ez03AkQt4A5HWmo3jRAV3DOyfKfCU4xiI7XCjLRjwnE/export?format=csv');
   const rows = (await res.text()).split('\n').slice(1);
   originalData = rows.map(row => row.split(',')).filter(cols => cols.length > 30);
   originalData.forEach(cols => {
     cols.push(parseInt(cols[4]) * 60 + parseInt(cols[5]));
   });
   renderTable(originalData);
 }
 
 function renderTable(data) {
   const tableBody = document.getElementById('tableBody');
   tableBody.innerHTML = '';
 
   const minGamesOnly = document.getElementById('minGamesCheckbox').checked;
   const filteredData = minGamesOnly ? data.filter(cols => parseInt(cols[3]) >= 14) : data;
 
   filteredData.forEach(cols => {
     const playerName = cols[2];
     const status = cols[3] >= 14 ? '✅' : '⚠️';
     const playtime = `${cols[4]}분 ${cols[5]}초`;
 
     const row = document.createElement('tr');
     row.innerHTML = `
       <td>${playerName} <span class="${cols[3] >= 20 ? 'valid' : 'warning'}">${status}</span></td>
       <td>${cols[1]}</td>
       <td>${cols[3]}</td>
       <td data-time="${cols[cols.length - 1]}">${playtime}</td>
       <td>${cols[6]}</td>
       <td>${(+cols[7]).toFixed(2)}</td>
       <td>${cols[8]}</td>
       <td>${cols[9]}</td>
       <td>${cols[10]}</td>
       <td>${cols[11]}</td>
       <td>${cols[12]}</td>
       <td>${cols[13]}</td>
       <td>${cols[14]}</td>
       <td>${cols[15]}</td>
       <td>${cols[16]}</td>
       <td>${cols[17]}</td>
       <td>${cols[18]}</td>
       <td>${cols[19]}</td>
       <td>${cols[20]}</td>
       <td>${cols[21]}</td>
       <td>${cols[22]}</td>
       <td>${(+cols[23]).toFixed(2)}</td>
       <td>${cols[24]}</td>
       <td>${(+cols[25]).toFixed(2)}</td>
       <td>${cols[26]}</td>
       <td>${(+cols[27]).toFixed(2)}</td>
       <td>${cols[28]}</td>
       <td>${(+cols[29]).toFixed(2)}</td>
       <td>${cols[30]}</td>
       <td>${cols[31]}</td>
       <td>${cols[32]}</td>
       <td>${cols[33]}</td>
       <td>${cols[34]}</td>
       <td>${cols[35]}</td>
       <td>${cols[36]}</td>
       <td>${cols[37]}</td>
       <td>${cols[38]}</td>
       <td>${cols[39]}</td>
       <td>${cols[40]}</td>
       <td>${cols[41]}</td>
       <td>${cols[42]}</td>
       <td>${cols[43]}</td>
       <td>${cols[44]}</td>
       <td>${cols[45]}</td>
       <td>${cols[46]}</td>
       <td>${cols[47]}</td>
       <td>${cols[48]}</td>
     `;
     tableBody.appendChild(row);
   });
 
   setTimeout(() => {
     const tableWidth = document.getElementById('statsTable').offsetWidth;
     document.getElementById('scroll-sync').style.width = tableWidth + 'px';
   }, 200);
 }
 
function searchPlayer(){
  const query = document.getElementById('searchPlayerAll').value.toLowerCase().trim();
  clearFixedRow();
  const rows = document.querySelectorAll('#tableBody tr');
  let found = false;
  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();
    row.classList.remove('highlight');
    if (name.includes(query)){
      found = true;
      row.classList.add('highlight');
      fixRow(row);
    }
  });
  if (!found) alert("Player not found!");
}
 
 function fixRow(row) {
  clearFixedRow();
  fixedRow = row.cloneNode(true);
  fixedRow.classList.add('fixed-row', 'highlight');
  fixedRow.style.position = 'sticky';
  fixedRow.style.top = '34px';
  fixedRow.style.backgroundColor = '#000';
  fixedRow.style.zIndex = '500';

  const releaseBtn = document.createElement('button');
  releaseBtn.textContent = '해제';
  releaseBtn.style.marginLeft = '10px';
  releaseBtn.onclick = () => {
    clearFixedRow();
    document.getElementById('searchPlayerAll').value = "";
  };

  fixedRow.cells[0].appendChild(releaseBtn);
  document.querySelector('#statsTable thead').after(fixedRow);
}

function clearFixedRow() {
  if (fixedRow) {
    const originalRows = document.querySelectorAll('#tableBody tr');
    originalRows.forEach(row => row.classList.remove('highlight'));
    fixedRow.remove();
  }
  fixedRow = null;
}
 
 const sortDirections = {};
 document.querySelectorAll('#statsTable th').forEach((header, index) => {
   sortDirections[index] = 'asc';
   header.onclick = () => sortTable(index);
 });
 
 function sortTable(i) {
   const tableBody = document.getElementById('tableBody');
   const rows = [...tableBody.rows];
   const direction = sortDirections[i] === 'asc' ? 'desc' : 'asc';
   sortDirections[i] = direction;
 
   rows.sort((a, b) => {
     let x, y;
     if (i === 3) {
       x = parseInt(a.cells[i].getAttribute('data-time'), 10);
       y = parseInt(b.cells[i].getAttribute('data-time'), 10);
     } else {
       x = parseFloat(a.cells[i].innerText) || 0;
       y = parseFloat(b.cells[i].innerText) || 0;
     }
     return direction === 'asc' ? x - y : y - x;
   }).forEach(row => tableBody.appendChild(row));
 
   const currentSearch = document.getElementById('playerSearch').value.trim();
   if (currentSearch !== "") searchPlayer(); 
   else clearFixedRow(); 
 }
 
 window.onload = loadPlayersData;
 
 document.getElementById('minGamesCheckbox').addEventListener('change', function() {
   renderTable(originalData);
 });

  function calculateRank(filteredData, statIndex, playerValue, isHigherBetter = true) {
  const sorted = filteredData
    .map(cols => parseFloat(cols[statIndex]))
    .filter(value => !isNaN(value))
    .sort((a, b) => isHigherBetter ? b - a : a - b);

  return sorted.indexOf(parseFloat(playerValue)) + 1;
}

  function showPlayerStats() {
  const playerNameInput = document.getElementById('searchPlayer').value.trim();
  
  const minGamesChecked = document.getElementById('minGames').checked;
  let filteredData = originalData;
  if (minGamesChecked) {
    filteredData = originalData.filter(cols => parseInt(cols[3]) >= 14);
  }

  const playerData = filteredData.find(cols => 
    cols[2].trim().toLowerCase().includes(playerNameInput.toLowerCase())
  );

  if (playerData) {
    document.getElementById('playerName').innerText = playerData[2];
    document.getElementById('teamName').innerText = '(' + playerData[1] + ')';

    const statsContainer = document.getElementById('statsContainer');
    statsContainer.innerHTML = '';

    statsContainer.innerHTML += createCard('기본 정보', [
      {label: '출전 경기 수', value: playerData[3] + '경기', rank: calculateRank(filteredData, 3, playerData[3], true) + '위'},
      {label: '평균 출전 시간', value: playerData[4] + '분 ' + playerData[5] + '초', rank: calculateRank(filteredData, 4, playerData[4], true) + '위'},
      {label: '총 득점', value: playerData[9] + '점', rank: calculateRank(filteredData, 9, playerData[9], true) + '위', highlight: true},
      {label: '평균 득점', value: parseFloat(playerData[10]).toFixed(2) + '점', rank: calculateRank(filteredData, 10, playerData[10], true) + '위', highlight: true}
    ], 'primary');

    statsContainer.innerHTML += createCard('슈팅 지표', [
      {label: '평균 FG 시도', value: playerData[15], rank: calculateRank(filteredData, 15, playerData[15], true) + '위'},
      {label: '평균 FG 성공', value: playerData[16], rank: calculateRank(filteredData, 16, playerData[16], true) + '위'},
      {label: '평균 2P 시도', value: playerData[23], rank: calculateRank(filteredData, 23, playerData[23], true) + '위'},
      {label: '평균 2P 성공', value: playerData[24], rank: calculateRank(filteredData, 24, playerData[24], true) + '위'},
      {label: '평균 3P 시도', value: playerData[31], rank: calculateRank(filteredData, 31, playerData[31], true) + '위'},
      {label: '평균 3P 성공', value: playerData[32], rank: calculateRank(filteredData, 32, playerData[32], true) + '위'},
      {label: '평균 FT 시도', value: playerData[39], rank: calculateRank(filteredData, 39, playerData[39], true) + '위'},
      {label: '평균 FT 성공', value: playerData[40], rank: calculateRank(filteredData, 40, playerData[40], true) + '위'}
    ], 'primary');

    statsContainer.innerHTML += createCard('슈팅 성공률', [
      {label: 'FG%', value: playerData[17], rank: calculateRank(filteredData, 17, playerData[17], true) + '위'},
      {label: '2P%', value: playerData[25], rank: calculateRank(filteredData, 25, playerData[25], true) + '위'},
      {label: '3P%', value: playerData[33], rank: calculateRank(filteredData, 33, playerData[33], true) + '위'},
      {label: 'FT%', value: playerData[41], rank: calculateRank(filteredData, 41, playerData[41], true) + '위'}
    ], 'primary');

    statsContainer.innerHTML += createCard('리바운드 지표', [
      {label: '총 리바운드', value: playerData[45], rank: calculateRank(filteredData, 45, playerData[45], true) + '위', highlight: true},
      {label: '평균 리바운드', value: parseFloat(playerData[46]).toFixed(2), rank: calculateRank(filteredData, 46, playerData[46], true) + '위', highlight: true},
      {label: '공격 리바운드', value: playerData[49], rank: calculateRank(filteredData, 49, playerData[49], true) + '위'},
      {label: '평균 공격 리바운드', value: parseFloat(playerData[50]).toFixed(2), rank: calculateRank(filteredData, 50, playerData[50], true) + '위'},
      {label: '수비 리바운드', value: playerData[53], rank: calculateRank(filteredData, 53, playerData[53], true) + '위'},
      {label: '평균 수비 리바운드', value: parseFloat(playerData[54]).toFixed(2), rank: calculateRank(filteredData, 54, playerData[54], true) + '위'}
    ], 'primary');

    statsContainer.innerHTML += createCard('어시스트/스틸/블록 지표', [
      {label: '총 어시스트', value: playerData[57], rank: calculateRank(filteredData, 57, playerData[57], true) + '위'},
      {label: '평균 어시스트', value: parseFloat(playerData[58]).toFixed(2), rank: calculateRank(filteredData, 58, playerData[58], true) + '위'},
      {label: '총 스틸', value: playerData[61], rank: calculateRank(filteredData, 61, playerData[61], true) + '위'},
      {label: '평균 스틸', value: parseFloat(playerData[62]).toFixed(2), rank: calculateRank(filteredData, 62, playerData[62], true) + '위'},
      {label: '총 블록', value: playerData[65], rank: calculateRank(filteredData, 65, playerData[65], true) + '위'},
      {label: '평균 블록', value: parseFloat(playerData[66]).toFixed(2), rank: calculateRank(filteredData, 66, playerData[66], true) + '위'}
    ], 'primary');

    statsContainer.innerHTML += createCard('기타 지표', [
      {label: '턴오버', value: playerData[69], rank: calculateRank(filteredData, 69, playerData[69], false) + '위'},
      {label: '평균 턴오버', value: parseFloat(playerData[70]).toFixed(2), rank: calculateRank(filteredData, 70, playerData[70], false) + '위'},
      {label: '파울', value: playerData[73], rank: calculateRank(filteredData, 73, playerData[73], false) + '위'},
      {label: '평균 파울', value: parseFloat(playerData[74]).toFixed(2), rank: calculateRank(filteredData, 74, playerData[74], false) + '위'}
    ], 'primary');


statsContainer.innerHTML += createCard('WinShare 지표', [
  {label: 'WS', value: playerData[77], rank: calculateRank(filteredData, 77, playerData[77], true) + '위', highlight: true},
  {label: 'WS/40', value: playerData[78], rank: calculateRank(filteredData, 78, playerData[78], true) + '위'},
  {label: 'Offensive WS', value: playerData[79], rank: calculateRank(filteredData, 79, playerData[79], true) + '위'},
  {label: 'Defensive WS', value: playerData[80], rank: calculateRank(filteredData, 80, playerData[80], true) + '위'}
], 'secondary');



statsContainer.innerHTML += createCard('효율성 지표', [
  {label: 'PER', value: playerData[87], rank: calculateRank(filteredData, 87, playerData[87], true) + '위'},
  {label: 'EFF', value: playerData[88], rank: calculateRank(filteredData, 88, playerData[88], true) + '위'},
  {label: 'EFF/40', value: playerData[89], rank: calculateRank(filteredData, 89, playerData[89], true) + '위'},
  {label: 'Offensive Rating', value: playerData[85], rank: calculateRank(filteredData, 85, playerData[85], true) + '위'},
  {label: 'Defensive Rating', value: playerData[86], rank: calculateRank(filteredData, 86, playerData[86], false) + '위'},
  {label: 'USG%', value: playerData[97] + '%', rank: calculateRank(filteredData, 97, playerData[97], true) + '위'}
], 'secondary');



statsContainer.innerHTML += createCard('2차 슈팅 지표', [
  {label: 'TS%', value: playerData[95], rank: calculateRank(filteredData, 95, playerData[95], true) + '위'},
  {label: 'eFG%', value: playerData[96], rank: calculateRank(filteredData, 96, playerData[96], true) + '위'},
  {label: '3PAr', value: playerData[98], rank: calculateRank(filteredData, 98, playerData[98], true) + '위'},
  {label: 'FTr', value: playerData[99], rank: calculateRank(filteredData, 99, playerData[99], true) + '위'}
], 'secondary');



statsContainer.innerHTML += createCard('팀내 비중 지표', [
  {label: 'ORB%', value: playerData[105] + '%', rank: calculateRank(filteredData, 105, playerData[105], true) + '위'},
  {label: 'DRB%', value: playerData[106] + '%', rank: calculateRank(filteredData, 106, playerData[106], true) + '위'},
  {label: 'TRB%', value: playerData[107] + '%', rank: calculateRank(filteredData, 107, playerData[107], true) + '위'},
  {label: 'AST%', value: playerData[108] + '%', rank: calculateRank(filteredData, 108, playerData[108], true) + '위'},
  {label: 'STL%', value: playerData[109] + '%', rank: calculateRank(filteredData, 109, playerData[109], true) + '위'},
  {label: 'BLK%', value: playerData[110] + '%', rank: calculateRank(filteredData, 110, playerData[110], true) + '위'},
  {label: 'TOV%', value: playerData[111] + '%', rank: calculateRank(filteredData, 111, playerData[111], false) + '위'}
], 'team-stats');


  } else {
    alert('선수를 찾을 수 없습니다.');
  }
}
 document.getElementById('searchPlayerAll').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    searchPlayer();
  }
});

function createCard(title, stats, type = 'primary') {
  return `
    <div class="card ${type}">
      <h3>${title}</h3>
      <table>
        ${stats.map(stat => `
          <tr class="${stat.highlight ? 'highlight' : ''}">
            <th>${stat.label}</th>
            <td>${stat.value}</td>
            <td>${stat.rank}</td>
          </tr>
        `).join('')}
      </table>
    </div>
  `;
}

// 전체 통계 검색창에서 엔터 키 동작
document.getElementById('searchPlayerAll').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    searchPlayer();
  }
});

// 개인 선수 탭 검색창에서 엔터 키 동작
document.getElementById('searchPlayer').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    showPlayerStats();
  }
});

  
 </script>
 
 
 </body>
 </html>
