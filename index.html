<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Basketball Stats Analyzer</title>
<style>
body {
  background: #121212;
  color: #FFF;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  overflow: hidden;
}
.container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  max-width: 1200px;
  margin: auto;
  padding: 20px;
  box-sizing: border-box;
}
h2, .input-box, .footer { text-align: center; }
h2 { color: #FFA500; }
.input-box { padding: 10px 0; background: #1e1e1e; }

.scroll-container {
  flex: 1;
  overflow: auto;
  margin: 10px 0;
  padding-bottom: 100px; /* footer 여유 확보 */
  position: relative;
  height: calc(100% - 120px); /* 명확한 높이 지정 */
}

table {
  border-collapse: collapse;
  white-space: nowrap;
  min-width: 1500px;
}

thead th {
  background: #282828;
  position: sticky;
  top: 0;
  cursor: pointer;
  z-index: 200; /* ✅ 정확한 수정값 */
}

tbody td {
  background: #181818;
}

th, td {
  padding: 6px 8px;
  border-bottom: 1px solid #333;
  font-size: 0.85rem;
  color: #FFF;
  text-align: center;
}

/* 좌측 고정 열 설정 확실히 조정 */
th:nth-child(1), td:nth-child(1),
th:nth-child(2), td:nth-child(2) {
  position: sticky;
  left: 0;
  background-color: #282828;
  z-index: 300; /* ✅ 정확한 수정값 */
}

th:nth-child(2), td:nth-child(2) {
  left: 150px;
}

.valid { color: #55FF55; }
.warning { color: #FF5555; }
.highlight { border-bottom: 3px solid #FFA500 !important; }

.footer {
  padding: 10px 0;
  border-top: 1px solid #333;
  font-size: 0.8rem;
  color: #888;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background-color: #000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  pointer-events: none;
}

.footer img { width: 100px; height: auto; margin-bottom: 5px; }

.scroll-container::-webkit-scrollbar { height: 8px; width: 8px; }
.scroll-container::-webkit-scrollbar-track { background: #282828; }
.scroll-container::-webkit-scrollbar-thumb { background: #FFA500; border-radius: 10px; }

thead th:nth-child(1), 
thead th:nth-child(2) {
  position: sticky;
  top: 0;
  left: 0;
  background-color: #282828;
  z-index: 400; /* 가장 높게 설정 */
}

thead th:nth-child(2) {
  left: 150px; /* 두 번째 열 위치 유지 */
}  
/* 고정된 선수 행 폰트 컬러를 노란색으로 변경 */
.highlight, .highlight td, .highlight span {
  color: #FFFF55 !important;
  font-weight: bold;
}  
</style>
</head>
<body>
<div class="container">
  <h2>Basketball Stats Analyzer</h2>
  <div class="input-box">
    <input type="text" id="playerSearch" placeholder="Search player..." />
    <button onclick="searchPlayer()">Search</button>
  </div>
<div class="scroll-container">
  <table id="statsTable">
    <thead>
      <tr>
        <th>선수 이름</th><th>팀</th><th>경기수(G)</th><th>출전시간</th>
        <th>PTS(총득점)</th><th>PTS_avg</th><th>FG</th><th>FGA</th><th>FG%</th>
        <th>2P</th><th>2PA</th><th>2P%</th><th>3P</th><th>3PA</th><th>3P%</th>
        <th>FT</th><th>FTA</th><th>FT%</th><th>ORB</th><th>DRB</th><th>TRB</th>
        <th>TRB_avg</th><th>AST</th><th>AST_avg</th><th>STL</th><th>STL_avg</th>
        <th>BLK</th><th>BLK_avg</th><th>TO</th><th>PF</th><th>WS</th><th>OWS</th>
        <th>DWS</th><th>PER</th><th>TS%</th><th>eFG%</th><th>USG%</th>
        <th>Off Rating</th><th>Def Rating</th><th>Eff/Game</th><th>Eff/40min</th>
        <th>ORB%</th><th>DRB%</th><th>AST%</th><th>STL%</th><th>BLK%</th><th>TOV%</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>
  <footer class="footer">
    <img src="https://github.com/dookie777/vibe-index/blob/main/Logo_white.png?raw=true">
    <div>© 2025 The Eroom Sports. All rights reserved.</div>
  </footer>
</div>
<script>
let originalData = [], highlightedPlayer = '', fixedRow = null;

async function loadPlayersData() {
  const res = await fetch('https://docs.google.com/spreadsheets/d/1ez03AkQt4A5HWmo3jRAV3DOyfKfCU4xiI7XCjLRjwnE/export?format=csv');
  const rows = (await res.text()).split('\n').slice(1);
  originalData = rows.map(row => row.split(',')).filter(cols => cols.length > 30);
  originalData.forEach(cols => {
    cols.push(parseInt(cols[4]) * 60 + parseInt(cols[5]));
  });
  renderTable(originalData);
}

function renderTable(data) {
  const tableBody = document.getElementById('tableBody');
  tableBody.innerHTML = '';

  data.forEach(cols => {
    const playerName = cols[2];
    const status = cols[3] >= 20 ? '✅' : '⚠️';
    const playtime = `${cols[4]}분 ${cols[5]}초`;

    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${playerName} <span class="${cols[3] >= 20 ? 'valid' : 'warning'}">${status}</span></td>
      <td>${cols[1]}</td>
      <td>${cols[3]}</td>
      <td data-time="${cols[49]}">${playtime}</td>
      <td>${cols[6]}</td>
      <td>${(+cols[7]).toFixed(2)}</td>
      <td>${cols[8]}</td>
      <td>${cols[9]}</td>
      <td>${cols[10]}</td>
      <td>${cols[11]}</td>
      <td>${cols[12]}</td>
      <td>${cols[13]}</td>
      <td>${cols[14]}</td>
      <td>${cols[15]}</td>
      <td>${cols[16]}</td>
      <td>${cols[17]}</td>
      <td>${cols[18]}</td>
      <td>${cols[19]}</td>
      <td>${cols[20]}</td>
      <td>${cols[21]}</td>
      <td>${cols[22]}</td>
      <td>${(+cols[23]).toFixed(2)}</td>
      <td>${cols[24]}</td>
      <td>${(+cols[25]).toFixed(2)}</td>
      <td>${cols[26]}</td>
      <td>${(+cols[27]).toFixed(2)}</td>
      <td>${cols[28]}</td>
      <td>${(+cols[29]).toFixed(2)}</td>
      <td>${cols[30]}</td>
      <td>${cols[31]}</td>
      <td>${cols[32]}</td>
      <td>${cols[33]}</td>
      <td>${cols[34]}</td>
      <td>${cols[35]}</td>
      <td>${cols[36]}</td>
      <td>${cols[37]}</td>
      <td>${cols[38]}</td>
      <td>${cols[39]}</td>
      <td>${cols[40]}</td>
      <td>${cols[41]}</td>
      <td>${cols[42]}</td>
      <td>${cols[43]}</td>
      <td>${cols[44]}</td>
      <td>${cols[45]}</td>
      <td>${cols[46]}</td>
      <td>${cols[47]}</td>
      <td>${cols[48]}</td>
    `;
    tableBody.appendChild(row);
  });
}

function searchPlayer() {
  const query = document.getElementById('playerSearch').value.toLowerCase();
  const rows = document.querySelectorAll('#tableBody tr');
  let found = false;

  rows.forEach(row => {
    const name = row.cells[0].textContent.toLowerCase();
    row.classList.remove('highlight');
    row.style.position = '';
    row.style.top = '';
    row.style.backgroundColor = '';
    
    if (name.includes(query) && query !== "") {
      found = true;
      row.classList.add('highlight');
      fixRow(row);
    }
  });

  if (!found) alert("Player not found!");
}

function fixRow(row) {
  clearFixedRow();
  fixedRow = row.cloneNode(true);
  fixedRow.style.position = 'sticky';
  fixedRow.style.top = '34px'; /* 헤더 높이에 맞추어 조정 */
fixedRow.style.backgroundColor = 'transparent';
  fixedRow.style.zIndex = '500';

  const releaseBtn = document.createElement('button');
  releaseBtn.textContent = '해제';
  releaseBtn.style.marginLeft = '10px';
  releaseBtn.onclick = clearFixedRow;

  fixedRow.cells[0].appendChild(releaseBtn);

  document.querySelector('#statsTable thead').after(fixedRow);
}

function clearFixedRow() {
  if (fixedRow) fixedRow.remove();
  fixedRow = null;
}

const sortDirections = {};
document.querySelectorAll('th').forEach((h, i) => {
  h.onclick = () => sortTable(i);
});

function sortTable(i) {
  const tableBody = document.getElementById('tableBody');
  const rows = [...tableBody.rows];
  const direction = sortDirections[i] === 'asc' ? 'desc' : 'asc';
  sortDirections[i] = direction;

  rows.sort((a, b) => {
    let x, y;
    if (i === 3) { 
      x = +a.cells[i].getAttribute('data-time');
      y = +b.cells[i].getAttribute('data-time');
    } else {
      x = parseFloat(a.cells[i].innerText) || 0;
      y = parseFloat(b.cells[i].innerText) || 0;
    }
    return direction === 'asc' ? x - y : y - x;
  }).forEach(r => tableBody.appendChild(r));
}

window.onload = loadPlayersData;
</script></body>
</html>
